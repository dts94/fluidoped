<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FluidoPED</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Estilos personalizados para toques infantiles y colores espec√≠ficos */
        body {
            font-family: 'Arial', sans-serif;
            background-color: #e0f7fa;
            color: #004d40;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: #ffffff;
            padding: 30px;
            border-radius: 20px; /* Borde suavizado */
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.1);
        }

        h1.main-title {
            text-align: center;
            font-weight: bold;
            font-size: 47px;
            margin-bottom: 25px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .title-part-1 {
            color: #0077cc; /* Azul principal */
        }

        .title-part-2 {
            color: #4A5568; /* Gris oscuro neutro */
        }

        .logo-svg {
            width: 28.2px;
            height: 42.3px;
            margin-right: 12px;
            vertical-align: middle;
        }

        .subtitle-text {
            text-align: center; 
            margin-bottom: 30px; 
            color: #0077cc; 
            font-size: 1.1em;
        }

        .section-title {
            color: #0077cc;
            text-align: center;
            font-weight: bold;
            font-size: 23px; /* Tama√±o de fuente aumentado */
            margin-bottom: 25px;
            border-bottom: 1px solid #d1d5db; /* Encabezado prominente */
            padding-bottom: 12px; /* Espacio para el borde */
        }
        
        .styled-h3, #gorelick-section-clasica h3.styled-h3, #gorelick-section-rapida h3.styled-h3 {
             text-align: left;
             margin-top: 0;
             margin-bottom: 1rem;
             padding-bottom: 0;
             font-size: 22px; /* Mantener tama√±o para subt√≠tulos */
             color: #2c5282;
             font-weight: bold;
        }
        
        .consideraciones-previas-title {
            font-weight: bold;
            color: #005662;
            font-size: 1.1em;
            margin-bottom: 12px;
            text-align:left;
        }
        
        .consideraciones-previas-container {
            background-color: #fffbeb; /* Color √°mbar de advertencia */
            border-left: 4px solid #fdba74; /* Color √°mbar de advertencia */
            padding: 12px 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-family: 'Arial', sans-serif;
        }
        .consideraciones-previas-container ul {
            list-style-type: disc; 
            padding-left: 25px; 
            margin-top: 5px;
        }
        .consideraciones-previas-container li {
            margin-bottom: 10px; 
            font-size: 0.9em;
            color: #422006; /* Texto m√°s oscuro para contraste en fondo √°mbar */
            line-height: 1.4; 
        }
        .consideraciones-previas-container code {
            font-family: 'Arial', sans-serif;
            letter-spacing: normal;
        }
        .consideraciones-previas-container ul ul {
            list-style-type: circle; 
            padding-left: 25px;
            margin-top: 8px;
        }
         .consideraciones-previas-container li strong {
            color: #92400e; 
         }
        .consideraciones-previas-container .sueros-table th {
            color: white; /* Color de fuente blanco para cabecera de tabla de sodio */
        }
        .consideraciones-previas-container .sueros-table td {
             color: #004d40; /* Color de fuente original para celdas */
        }


        .section {
            background-color: #f0f9ff; /* Celeste muy claro */
            padding: 25px;
            border-radius: 15px; /* Borde suavizado */
            margin-bottom: 30px;
            border: 1px solid #e0f2fe;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: bold; 
            color: #005662;
        }
        
        .input-group .radio-group label, 
        .gorelick-item label {
            font-weight: normal; 
            color: #005662;
            transition: font-weight 0.2s ease, color 0.2s ease, font-size 0.2s ease; 
            margin-right: 25px; 
            padding: 2px 0; 
            line-height: 1.8;
            display: inline-flex; 
            align-items: center; 
            font-size: 1em;
        }
        .gorelick-item label {
            margin-right: 10px; 
        }

        .input-group .radio-group label.selected-option-text,
        .gorelick-item label.selected-option-text {
            font-weight: bold !important;
            color: #005A9C !important;
            font-size: 1.08em;
            background-color: transparent !important; 
            text-shadow: none !important; 
        }


        .custom-input-select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #b0bec5;
            border-radius: 10px; /* Borde suavizado */
            background-color: white;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
            font-size: 1rem;
            color: #004d40;
            transition: border-color 0.2s ease, box-shadow 0.2s ease;
        }
        .custom-input-select:focus {
            outline: none;
            border-color: #0077cc;
            box-shadow: 0 0 0 0.2rem rgba(0,119,204,.25);
        }
        select.custom-input-select {
            appearance: none;
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%230077CC%22%20d%3D%22M287%2069.4a17.6%2017.6%200%200%200-13-5.4H18.4c-5%200-9.3%201.8-12.9%205.4A17.6%2017.6%200%200%200%200%2082.2c0%205%201.8%209.3%205.4%2012.9l128%20127.9c3.6%203.6%207.8%205.4%2012.8%205.4s9.2-1.8%2012.8-5.4L287%2095c3.5-3.5%205.4-7.8%205.4-12.8%200-5-1.9-9.2-5.4-12.9z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 12px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding-right: 40px; 
        }


        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background-color: #0077cc; /* Bot√≥n refinado - color s√≥lido */
            color: white;
            padding: 12px 24px;
            border-radius: 10px; /* Borde suavizado */
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease-in-out;
            border: none;
            margin-top: 15px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.15), 0 1px 2px rgba(0,0,0,0.1);
            font-weight: 500;
        }
        .btn svg, .btn .emoji-icon { 
            margin-right: 8px;
        }

        .btn:hover {
            background-color: #006ab7; /* Bot√≥n refinado - hover */
            box-shadow: 0 4px 8px rgba(0,0,0,0.2), 0 2px 4px rgba(0,0,0,0.15);
            transform: translateY(-1px);
        }
        .btn:active {
            background-color: #005a9c; /* Bot√≥n refinado - active */
            transform: translateY(0px);
            box-shadow: 0 1px 2px rgba(0,0,0,0.15);
        }

        /* Transici√≥n suave para los cuadros de resultados */
        .result {
            margin-top: 20px;
            background-color: #E0F2F1;
            border-radius: 12px;
            border: 1px dashed #4DB6AC;
            padding: 0 15px;
            max-height: 0;
            opacity: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out, padding 0.5s ease-out;
        }
        .result.show {
            padding: 15px;
            max-height: 1000px;
            opacity: 1;
        }
        
        .collapsible-container {
            display: grid;
            grid-template-rows: 0fr;
            transition: grid-template-rows 0.4s ease-out;
            margin-top: 20px;
        }
        .collapsible-container.show {
             grid-template-rows: 1fr;
        }
        .collapsible-container > div {
            overflow: hidden;
        }
        .table-wrapper {
             overflow-x: auto;
        }

        .result strong {
            color: #004d40;
        }

        .tabs {
            display: flex;
            flex-wrap: wrap;
            justify-content: center; /* Centrar pesta√±as */
            margin-bottom: 20px;
            border-bottom: 2px solid #b3e5fc;
            gap: 5px;
        }

        .tab-button {
            padding: 10px 15px;
            cursor: pointer;
            border: none;
            background-color: transparent;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            font-weight: bold;
            color: black; /* Color base no seleccionado */
            font-size: 17px; /* Tama√±o base */
            margin-right: 0;
            display: inline-flex; 
            align-items: center; 
        }
        .tab-button .emoji-icon { 
             margin-right: 5px;
        }

        .tab-button.active {
            border-bottom-color: #0077cc; /* Azul del t√≠tulo */
            color: #0077cc; /* Azul del t√≠tulo */
            font-size: 20px; /* Tama√±o aumentado */
        }

        .tab-button.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .tab-content {
            display: none;
            padding-top: 15px;
        }

        .tab-content.active {
            display: block;
        }

        .radio-group {
            display: flex;
            flex-wrap: wrap;
            align-items: center; 
        }

        .radio-group input[type="radio"] {
            margin-right: 5px;
            margin-bottom: 0; 
        }

        .icon { 
            vertical-align: middle;
            margin-right: 8px; 
        }

        .volume-option {
            display: inline-flex; 
            align-items: center; 
            justify-content: center; 
            padding: 12px 28px; 
            border: 1px solid #0077cc;
            border-radius: 25px; /* Borde suavizado */
            margin-right: 15px; 
            margin-bottom: 10px; 
            cursor: pointer;
            background-color: #e1f5fe;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease, font-weight 0.2s ease, color 0.2s ease;
            box-shadow: 0 1px 2px rgba(0,0,0,0.1);
            color: #005662; 
            line-height: 1.2; 
            font-size: 1.1em;
            min-width: 120px; 
            text-align: center;
        }

        .volume-option.selected {
            background-color: #0077cc;
            color: white !important; 
            border-color: #005fa3;
            box-shadow: 0 2px 4px rgba(0,0,0,0.15);
            font-weight: bold; 
            text-shadow: none; 
        }


        .volume-option input[type="radio"] {
            display: none;
        }

        .inline-input {
            display: inline-block;
            width: auto;
            margin-left: 10px;
        }
        
        #pauta-final-copy-container { 
            text-align: center;
            margin-top: 20px; 
        }

        .nota-text {
             font-size: 0.9em;
             color: #422006; /* Texto m√°s oscuro para contraste en fondo √°mbar */
             margin-top: 15px;
             margin-bottom: 10px;
             display: block;
             background-color: #fffbeb; /* Color √°mbar de advertencia */
             border-left: 4px solid #fdba74; /* Color √°mbar de advertencia */
             padding: 12px 15px;
             border-radius: 8px;
        }
        .nota-text strong {
            color: #422006;
            font-weight: bold;
        }
        .nota-text strong.negro {
            color: black;
        }
        .gorelick-item input[type="checkbox"] {
            margin-right: 10px;
            transform: scale(1.1);
        }
        .disclaimer-text {
            font-size: 0.75em;
            color: #455a64;
            margin-top: 30px;
            text-align: justify;
        }
        .version-text {
            font-size: 0.75em;
            color: #78909c;
            margin-top: 10px;
            text-align: center;
        }
        .sueros-table-container {
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,119,204,0.1);
            border: 1px solid #90cdf4;
            margin-top: 10px; 
        }
        .sueros-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
            font-size: 0.9em;
            background-color: #ffffff;
        }
        .sueros-table th, .sueros-table td {
            border: 1px solid #bee3f8;
            padding: 10px 12px;
            text-align: left;
            vertical-align: middle;
        }
        .sueros-table th {
            background-color: #3182ce;
            color: white;
            font-weight: bold;
        }
        .sueros-table th:first-child {
            border-top-left-radius: 7px;
        }
        .sueros-table th:last-child {
            border-top-right-radius: 7px;
        }
        .sueros-table tbody tr:nth-child(even) {
            background-color: #ebf8ff;
        }
        .sueros-table tbody tr:hover {
            background-color: #c3dafe;
        }
        .sueros-table tbody tr:last-child td:first-child {
            border-bottom-left-radius: 7px;
        }
        .sueros-table tbody tr:last-child td:last-child {
            border-bottom-right-radius: 7px;
        }

        #copy-toast {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #28a745; /* Paleta - Verde de √©xito */
            color: white;
            padding: 12px 20px;
            border-radius: 30px; /* Borde suavizado */
            z-index: 1000;
            visibility: hidden;
            opacity: 0;
            transition: visibility 0s, opacity 0.5s linear;
        }

        #copy-toast.show {
            visibility: visible;
            opacity: 1;
        }

        #deficit-warning-modal, #potassium-warning-modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 2000;
            background-color: #f44336; /* Rojo de alerta */
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            width: 90%;
            max-width: 500px;
            text-align: center;
            display: none; /* Oculto por defecto */
            align-items: center;
            justify-content: center;
            flex-direction: column;
        }
        #deficit-warning-modal p, #potassium-warning-modal p {
            margin: 0;
            margin-bottom: 20px;
            font-size: 1.1em;
            line-height: 1.5;
        }
        #deficit-warning-modal button, #potassium-warning-modal button {
            background-color: white;
            color: #d32f2f;
            border: 2px solid #d32f2f;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.2s ease;
        }
        #deficit-warning-modal button:hover, #potassium-warning-modal button:hover {
            background-color: #ffeeee;
        }

    </style>
</head>

<body>
    <div class="container">
        <h1 class="main-title">
            <svg class="logo-svg" viewBox="0 0 20 30" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M10 0C4.47715 0 0 4.47715 0 10C0 18.8326 10 30 10 30C10 30 20 18.8326 20 10C20 4.47715 15.5228 0 10 0Z" fill="#0077cc" transform="rotate(180 10 15)"/>
                <path d="M10 2.5C5.85786 2.5 2.5 5.85786 2.5 10C2.5 16.9355 5.9375 24.9688 10 31.0625C14.0625 24.9688 17.5 16.9355 17.5 10C17.5 5.85786 14.1421 2.5 10 2.5Z" fill="#4FC3F7" fill-opacity="0.7" transform="rotate(180 10 15)"/>
                <ellipse cx="10" cy="19" rx="2" ry="3" fill="white" fill-opacity="0.6" transform="rotate(180 10 19)"/>
            </svg>
            <span class="title-part-1">Fluido</span><span class="title-part-2">PED</span>
        </h1>
        <p class="subtitle-text">Herramienta para el c√°lculo de fluidoterapia intravenosa en pacientes pedi√°tricos.</p>

        <div class="section">
            <h2 class="section-title">Datos Iniciales</h2>
            <div style="text-align: center; margin-bottom: 20px;">
                <button class="btn" onclick="resetCalculator()">
                    <span class="emoji-icon">üë∂üèª</span> Nuevo Paciente
                </button>
            </div>
            <div class="input-group">
                <label for="peso">Peso del paciente (kg):</label>
                <input type="number" id="peso" step="0.1" min="0.1" class="custom-input-select">
            </div>
            <p class="nota-text"><strong>NOTA:</strong> Los siguientes c√°lculos son adecuados para mayores de un mes de vida.</p>
            <div class="input-group">
                <label>Volumen de la bolsa de suero que se va a emplear (ml):</label>
                <div class="radio-group" id="volumenBolsaOptions">
                    <label class="volume-option">
                        <input type="radio" name="volumenBolsa" value="100">100 ml
                    </label>
                    <label class="volume-option">
                        <input type="radio" name="volumenBolsa" value="250"> 250 ml
                    </label>
                    <label class="volume-option selected">
                        <input type="radio" name="volumenBolsa" value="500" checked> 500 ml
                    </label>
                </div>
            </div>
             <p class="nota-text">
                <strong class="negro">GU√çA DE USO:</strong><br>
                <strong style="color: #422006;">1¬∫</strong> Elecci√≥n del suero base del que se va a partir (en el programa de prescripci√≥n).<br>
                <strong style="color: #422006;">2¬∫</strong> C√°lculo del ritmo de infusi√≥n seg√∫n la sueroterapia elegida.<br>
                <strong style="color: #422006;">3¬∫</strong> Ajuste de los electrolitos seg√∫n se precise.<br>
                <strong style="color: #422006;">4¬∫</strong> Pauta final con todos estos c√°lculos.
             </p>
        </div>
        
        <div class="section">
            <h2 class="section-title">Elecci√≥n del Suero Base</h2>
             <div class="consideraciones-previas-container">
                <h4 class="consideraciones-previas-title">Sueros preferentes seg√∫n sueroterapia</h4>
                <ul>
                    <li><strong>Necesidades basales:</strong> <code>Salino 0,9%</code> (u otra soluci√≥n balanceada) + <code>Gluc 5%</code> +/- <code>K+ 20 mEq/L</code>.</li>
                    <li><strong>RIV r√°pida:</strong> <code>Salino 0,9%</code> (u otra soluci√≥n balanceada) +/- <code>Gluc 2,5%</code>.</li>
                    <li><strong>RIV cl√°sica:</strong> <code>Salino 0,9%</code> + <code>Gluc 5%</code> +/- <code>K+ 20 mEq/L</code>.</li>
                    <li><strong>HipoNa+ o HiperNa+:</strong> Seg√∫n natremia (Ver apartado <strong>üßÇSodio</strong>).</li>
                    <li><strong>Acidosis:</strong> Considerar <code>Ringer lactato</code> y <code>Bicarbonato 1/6M</code> (Ver apartado <strong>‚ö†Ô∏èAcidosis</strong>).</li>
                </ul>
            </div>
            <div style="text-align: center;">
                <button id="toggleSuerosBtn" class="btn"><span class="emoji-icon">üëÅÔ∏è</span>Mostrar Composici√≥n de Sueros</button>
            </div>
            <div id="tablaSuerosContainer" class="collapsible-container">
                <div>
                    <div class="table-wrapper sueros-table-container" style="margin-top:20px;">
                        <table class="sueros-table">
                            <thead>
                                <tr>
                                    <th>SUERO</th>
                                    <th>Osm (mosm/L)</th>
                                    <th>Glucosa (g/100mL)</th>
                                    <th>Na (mEq/L)</th>
                                    <th>CL (mEq/L)</th>
                                    <th>K (mEq/L)</th>
                                    <th>HCO3 (mEq/L)</th>
                                    <th>Ca (mEq/L)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>GR50</td><td>2770</td><td>50</td><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Salino 0,9%</td><td>308</td><td>-</td><td>154</td><td>154</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Salino 0,45%</td><td>154</td><td>-</td><td>77</td><td>77</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Salino 20%</td><td>6.800</td><td>-</td><td>3.400</td><td>3.400</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Salino 1M</td><td>2.000</td><td>-</td><td>1.000</td><td>1.000</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Salino 3%</td><td>1.026</td><td>-</td><td>513</td><td>513</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Salino 0,9% + Gluc 5%</td><td>585</td><td>5</td><td>154</td><td>154</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Glucosalino 1/2</td><td>290</td><td>2.5</td><td>77</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Glucosalino 1/3</td><td>285</td><td>3.3</td><td>51</td><td>77</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Glucosalino 1/5</td><td>280</td><td>4</td><td>30</td><td>51</td><td>-</td><td>-</td><td>-</td></tr>
                                <tr><td>Bicarbonato 1M</td><td>2.000</td><td>-</td><td>1.000</td><td>-</td><td>-</td><td>1.000</td><td>-</td></tr>
                                <tr><td>Bicarbonato 1/6M</td><td>334</td><td>-</td><td>167</td><td>-</td><td>-</td><td>167</td><td>-</td></tr>
                                <tr><td>Ringer Lactato</td><td>273</td><td>-</td><td>130</td><td>109</td><td>4</td><td>28</td><td>3</td></tr>
                                <tr><td>Glucosado 5% + 20 mL de Salino 20%/500mL + 10 mEq ClK/500mL</td><td>596</td><td>5</td><td>132</td><td>151</td><td>20</td><td>-</td><td>-</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Tipo de Sueroterapia</h2>
            <div class="input-group">
                <label for="modalidad">Seleccione el tipo de sueroterapia:</label>
                <select id="modalidad" onchange="showModalidadOptions()" class="custom-input-select">
                    <option value="">-- Seleccione --</option>
                    <option value="basales">Necesidades basales (Holiday y Segar)</option>
                    <option value="rapida">Rehidrataci√≥n intravenosa r√°pida</option>
                    <option value="clasica">Rehidrataci√≥n intravenosa cl√°sica</option>
                </select>
            </div>

            <!-- OPCIONES BASALES -->
            <div id="modalidad-basales" class="modalidad-options" style="display: none;">
                <div class="input-group">
                    <label for="fraccionNecesidadesBasales">Tipo de necesidades basales:</label>
                    <select id="fraccionNecesidadesBasales" class="custom-input-select">
                        <option value="1" selected>Necesidades basales completas</option>
                        <option value="2/3">‚Öî de necesidades basales</option>
                        <option value="1/2">¬Ω de necesidades basales</option>
                        <option value="1/3">‚Öì de necesidades basales</option>
                    </select>
                </div>
                 <p class="nota-text"><strong>NOTA:</strong> Si sospecha de SIADH (hiponatremia junto con sodio en orina >25 mEq/L o EFNa >1), ajustar ritmo de infusi√≥n seg√∫n la natremia: 135-130 mEq/L: ‚Öî de Necesidades Basales; 130-125 mEq/L: ¬Ω de Necesidades Basales; 125-120 mEq/L: ‚Öì de Necesidades Basales y valorar furosemida IV.</p>
                <button class="btn" onclick="calcularBasales()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/> 
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/> 
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Necesidades Basales
                </button>
                <div id="resultado-basales" class="result"></div>
            </div>

            <!-- OPCIONES RIV R√ÅPIDA -->
            <div id="modalidad-rapida" class="modalidad-options" style="display: none;">
                <div class="input-group">
                    <label>¬øP√©rdida de peso cuantificada entre visitas recientes a urgencias?</label>
                    <div class="radio-group" id="pesoCuantificadoOptions">
                        <label><input type="radio" name="pesoCuantificado" value="si"> S√≠</label>
                        <label><input type="radio" name="pesoCuantificado" value="no" checked> No</label>
                    </div>
                </div>

                <div id="perdida-peso-section" style="display: none; background-color: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <div class="input-group">
                        <label for="pesoPerdido">Peso perdido (kg):</label>
                        <input type="number" id="pesoPerdido" step="0.1" min="0" class="custom-input-select">
                    </div>
                    <button class="btn" onclick="calcularDeficitPorPesoPerdido()">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                            <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                            <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                            <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                            <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                            <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                            <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                            <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                            <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                            <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                            <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                        </svg>
                        Calcular d√©ficit de l√≠quidos
                    </button>
                </div>

                <div id="valoracion-clinica-section">
                    <div id="gorelick-section-rapida" style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h3 class="styled-h3">Escala de Gorelick (Valoraci√≥n de deshidrataci√≥n)</h3>
                        <div id="gorelick-items-container-rapida" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Ojos hundidos</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Mucosas secas</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Ausencia de l√°grima</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> P√©rdida de turgencia cut√°nea</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Deterioro del estado general</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Pulso radial d√©bil</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Frecuencia card√≠aca >150 lpm</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Respiraci√≥n anormal</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Oliguria</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickRapida" value="1"> Relleno capilar >2 seg</label></div>
                        </div>
                        <button class="btn mt-4" onclick="calcularGorelickRapida()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                                <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                                <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                                <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                                <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                            </svg>
                            Calcular Puntuaci√≥n
                        </button>
                         <div id="resultado-gorelick-rapida" class="result" style="margin-top: 15px;"></div>
                    </div>

                    <div id="porcentaje-deshidratacion-rapida-section" style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; margin-top:20px; border: 1px solid #dee2e6;">
                        <div class="input-group">
                            <label for="porcentajeDeshidratacionRapida">Porcentaje de deshidrataci√≥n (%):</label>
                            <input type="number" id="porcentajeDeshidratacionRapida" step="0.1" min="0" class="custom-input-select">
                        </div>
                        <button class="btn" onclick="calcularDeficitPorPorcentaje()">
                            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                                <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                                <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                                <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                                <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                            </svg>
                            Calcular d√©ficit de l√≠quidos
                        </button>
                    </div>
                </div>

                <div id="resultado-deficit-rapida" class="result" style="margin-top:15px;"></div>
                
                <div class="input-group" style="margin-top: 25px;">
                    <label for="tiempoRehidratacionRapida">Tiempo de rehidrataci√≥n intravenosa r√°pida (20ml/kg/hora):</label>
                    <select id="tiempoRehidratacionRapida" class="custom-input-select">
                        <option value="1">1 hora</option>
                        <option value="2" selected>2 horas</option>
                        <option value="3">3 horas</option>
                        <option value="4">4 horas</option>
                    </select>
                </div>
                <button class="btn" onclick="calcularRapida()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Rehidrataci√≥n R√°pida
                </button>
                <div id="resultado-rapida" class="result"></div>
                 <p class="nota-text" style="margin-top: 20px;"><strong class="negro">CONSIDERACIONES DURANTE RIV R√ÅPIDA:</strong><br>‚Ä¢ No superar el ritmo m√°ximo de 700 ml/h, y no infundir un volumen mayor al d√©ficit de l√≠quidos calculado.<br>‚Ä¢ Reevaluaciones horarias de signos de sobrecarga de volumen o persistencia de deshidrataci√≥n, vigilar diuresis.<br>‚Ä¢ Pesar al paciente antes de iniciar la rehidrataci√≥n y previo a alta.</p>
            </div>
            
             <!-- OPCIONES RIV CL√ÅSICA -->
            <div id="modalidad-clasica" class="modalidad-options" style="display: none;">
                <div class="input-group">
                    <label>¬øP√©rdida de peso cuantificada entre visitas recientes a urgencias?</label>
                    <div class="radio-group" id="pesoCuantificadoOptionsClasica">
                        <label><input type="radio" name="pesoCuantificadoClasica" value="si"> S√≠</label>
                        <label><input type="radio" name="pesoCuantificadoClasica" value="no" checked> No</label>
                    </div>
                </div>
                 <div id="perdida-peso-section-clasica" style="display: none; background-color: #f0f9ff; padding: 15px; border-radius: 8px; margin-top: 15px;">
                    <div class="input-group">
                        <label for="pesoPerdidoClasica">Peso perdido (kg):</label>
                        <input type="number" id="pesoPerdidoClasica" step="0.1" min="0" class="custom-input-select">
                    </div>
                </div>
                <div id="valoracion-clinica-section-clasica">
                     <div id="gorelick-section-clasica" style="background-color: #f8f9fa; padding: 20px; border-radius: 8px; border: 1px solid #dee2e6;">
                        <h3 class="styled-h3">Escala de Gorelick (Valoraci√≥n de deshidrataci√≥n)</h3>
                        <div id="gorelick-items-container-clasica" class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Ojos hundidos</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Mucosas secas</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Ausencia de l√°grima</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> P√©rdida de turgencia cut√°nea</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Deterioro del estado general</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Pulso radial d√©bil</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Frecuencia card√≠aca >150 lpm</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Respiraci√≥n anormal</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Oliguria</label></div>
                            <div class="gorelick-item"><label><input type="checkbox" name="gorelickClasica" value="1"> Relleno capilar >2 seg</label></div>
                        </div>
                        <button class="btn mt-4" onclick="calcularGorelickClasica()">
                             <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                                <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                                <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                                <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                                <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                                <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                            </svg>
                            Calcular Puntuaci√≥n
                        </button>
                        <div id="resultado-gorelick-clasica" class="result" style="margin-top: 15px;"></div>
                     </div>
                     <div class="input-group" id="porcentaje-deshidratacion-clasica-section" style="margin-top: 25px;">
                        <label for="porcentajeDeshidratacion">Porcentaje de deshidrataci√≥n (%):</label>
                        <input type="number" id="porcentajeDeshidratacion" step="0.1" min="0" class="custom-input-select">
                    </div>
                </div>

                <div class="result" id="basales-clasica-display" style="margin-top: 20px;"></div>
                 <div class="input-group">
                    <label>¬øAdministrada expansi√≥n o RIV r√°pida previa?:</label>
                    <div class="radio-group" id="expansionVolumenOptions">
                        <label><input type="radio" name="expansionVolumen" value="no" checked> No</label>
                        <label><input type="radio" name="expansionVolumen" value="si"> S√≠</label>
                        <input type="number" id="volumenExpansionMl" class="inline-input custom-input-select" step="1" min="0" placeholder="ml" style="display: none; width: 100px;">
                    </div>
                </div>
                
                <div class="input-group">
                    <label>P√©rdidas mantenidas:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="perdidasMantenidas" value="0" checked> No cuantificadas</label>
                        <label><input type="radio" name="perdidasMantenidas" value="quantified"> Cuantificadas</label>
                        <input type="number" id="perdidasMantenidasValor" class="inline-input custom-input-select" step="0.1" min="0" placeholder="ml/kg/d√≠a" style="display: none;">
                    </div>
                    <p class="nota-text"><strong>NOTA:</strong> P√©rdidas estimadas por diarrea: Leve (10-15 ml/kg/d√≠a); Moderada (25-50 ml/kg/d√≠a); Grave (50-75 ml/kg/d√≠a).</p>
                </div>
                <div class="input-group">
                    <label>Correcci√≥n del d√©ficit en 24h (seg√∫n natremia):</label>
                    <div class="radio-group">
                        <label><input type="radio" name="correccionDeficit" value="1" checked> Total (1/1)</label>
                        <label><input type="radio" name="correccionDeficit" value="2/3">2/3 del volumen total</label>
                        <label><input type="radio" name="correccionDeficit" value="1/3">1/3 del volumen total</label>
                    </div>
                    <p class="nota-text"><strong>NOTA:</strong> La reposici√≥n del d√©ficit de l√≠quidos en las deshidrataciones isot√≥nicas se realiza en 24 horas. Considerar una reposici√≥n m√°s lenta del d√©ficit en alteraciones de la natremia, considerando mayor lentitud contra mayor sea la magnitud de dicha alteraci√≥n y m√°s lenta haya sido su instauraci√≥n.</p>
                </div>
                <button class="btn" onclick="calcularClasica()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Rehidrataci√≥n Cl√°sica
                </button>
                <div id="resultado-clasica" class="result"></div>
                <p class="nota-text"><strong class="negro">CONSIDERACIONES DURANTE RIV CL√ÅSICA:</strong><br>‚Ä¢ Reevaluaciones peri√≥dicas, evaluando signos de sobrecarga de volumen o persistencia de deshidrataci√≥n, vigilar diuresis.<br>‚Ä¢ Pesar al paciente antes de iniciar la rehidrataci√≥n y diariamente mientras se mantenga sueroterapia.</p>
            </div>
        </div>
       
        <div class="section">
            <h2 class="section-title">Electrolitos y Correcciones</h2>
            <div class="tabs">
                <button class="tab-button active" onclick="openTab(event, 'glucosa')"><span class="emoji-icon">üç¨</span>Glucosa</button>
                <button class="tab-button" id="potasio-tab" onclick="openTab(event, 'potasio')"><span class="emoji-icon">üçå</span>Potasio</button>
                <button class="tab-button" id="sodio-tab" onclick="openTab(event, 'sodio')"><span class="emoji-icon">üßÇ</span>Sodio</button>
                <button class="tab-button" onclick="openTab(event, 'acidosis')"><span class="emoji-icon">‚ö†Ô∏è</span>Acidosis</button>
            </div>

            <div id="glucosa" class="tab-content active">
                <p id="nota-glucosa-rapida" class="nota-text" style="display: none;"></p>
                <div class="input-group">
                    <label>¬øSu suero base tiene aportes de glucosa?</label>
                    <div class="radio-group" id="sueroBaseGlucosaOptions">
                        <label><input type="radio" name="sueroBaseConGlucosa" value="true"> S√≠, mi suero base tiene glucosa al 5%</label>
                        <label><input type="radio" name="sueroBaseConGlucosa" value="false" checked> No, mi suero base no tiene glucosa</label>
                    </div>
                </div>
                <div class="input-group">
                    <label for="concentracionGlucosa">Concentraci√≥n deseada (%):</label>
                    <input type="number" id="concentracionGlucosa" step="0.1" min="0" class="custom-input-select">
                </div>
                <p class="nota-text"><strong>NOTA:</strong> Por v√≠a venosa perif√©rica, la concentraci√≥n m√°xima de glucosa ser√≠a de un 12%, en el caso de precisar una concentraci√≥n mayor se requerir√≠a de una v√≠a venosa central.</p>
                <div class="input-group">
                    <label>Unidad de aporte de glucosa:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="unidadGlucosa" value="mg/kg/min" checked> mg/kg/min</label>
                        <label><input type="radio" name="unidadGlucosa" value="g/kg/h"> g/kg/h</label>
                    </div>
                </div>
                <button class="btn" onclick="calcularGlucosa()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Glucosa
                </button>
                <div id="resultado-glucosa" class="result"></div>
                 <p class="nota-text"><strong>NOTA ACERCA DE LOS RESULTADOS:</strong> Si se ha elegido a√±adir GR50, para que la concentraci√≥n y los aportes finales se correspondan con los calculados, esto implicar√≠a retirar previamente del suero base el volumen de GR50 que se va a a√±adir. En la pr√°ctica cl√≠nica habitual, para reducir manipulaciones, es frecuente no realizar dicha retirada, asumiendo una concentraci√≥n y aporte de glucosa algo menores a los calculados, en general con escasa relevancia cl√≠nica (Ej: a√±adiendo GR50 a un suero base limpio para alcanzar glucosa al 5%, si no se realiza dicha retirada previa, la concentraci√≥n resultante ser√≠a del 4,5%).</p>
            </div>

            <div id="potasio" class="tab-content">
                <p class="nota-text"><strong>NOTA:</strong> Antes de a√±adir potasio, comprobar diuresis adecuada, ausencia de hiperpotasemia y funci√≥n renal normal.</p>
                 <div class="input-group">
                    <label>¬øSu suero base tiene aportes de potasio?</label>
                    <div class="radio-group" id="sueroBasePotasioOptions">
                        <label><input type="radio" name="sueroBaseConPotasio" value="true"> S√≠, mi suero base tiene potasio a necesidades basales (20 mEq/L)</label>
                        <label><input type="radio" name="sueroBaseConPotasio" value="ringer"> Mi suero base es Ringer lactato (4 mEq/L)</label>
                        <label><input type="radio" name="sueroBaseConPotasio" value="false" checked> No, mi suero base no tiene potasio</label>
                    </div>
                </div>
                <div class="input-group">
                    <label>Concentraci√≥n deseada (mEq/L):</label>
                    <div class="radio-group" id="potasio-options">
                        <label id="labelSinAnadirPotasio"><input type="radio" name="concentracionPotasio" value="none" checked> Sin a√±adir</label>
                        <label><input type="radio" name="concentracionPotasio" value="20"> Basales (20 mEq/L)</label>
                        <label><input type="radio" name="concentracionPotasio" value="30"> 30 mEq/L</label>
                        <label><input type="radio" name="concentracionPotasio" value="35"> 35 mEq/L</label>
                        <label><input type="radio" name="concentracionPotasio" value="40"> 40 mEq/L</label>
                    </div>
                </div>
                <div class="input-group">
                    <label>Forma de administraci√≥n:</label>
                    <select id="formaPotasio" class="custom-input-select">
                        <option value="Cloruro pot√°sico" selected>Cloruro pot√°sico (1 mEq/mL)</option>
                        <option value="Acetato pot√°sico">Acetato pot√°sico (1 mEq/mL)</option>
                    </select>
                </div>
                <p class="nota-text" style="margin-top:0; margin-bottom:15px;"><strong>NOTA:</strong> En el caso de emplear una concentraci√≥n de potasio &gt;40 mEq/L o un aporte de potasio &gt;0,3 mEq/Kg/h, el paciente precisa de monitorizaci√≥n continua de ECG.</p>
                <button class="btn" onclick="calcularPotasio()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Potasio
                </button>
                <div id="resultado-potasio" class="result"></div>
                <p class="nota-text"><strong>NOTA ACERCA DE LOS RESULTADOS:</strong> Si se ha elegido a√±adir cloruro/acetato pot√°sico 1M, para que la concentraci√≥n y los aportes finales se correspondan con los calculados, esto implicar√≠a retirar previamente del suero base el volumen de cloruro o acetato pot√°sico 1M que se va a a√±adir. En la pr√°ctica cl√≠nica habitual, para reducir manipulaciones, es frecuente no realizar dicha retirada, asumiendo una concentraci√≥n y aporte de potasio algo menores a los calculados, en general con escasa relevancia cl√≠nica (Ej: a√±adiendo cloruro pot√°sico 1M a un suero base limpio para alcanzar 20 mEq/L, si no se realiza dicha retirada previa, la concentraci√≥n resultante ser√≠a de 19,6 mEq/L).</p>
            </div>

            <div id="sodio" class="tab-content">
                 <div class="consideraciones-previas-container">
                    <h4 class="consideraciones-previas-title">CONSIDERACIONES PREVIAS</h4>
                    <ul>
                        <li><strong>Alteraciones de Natremia:</strong> En deshidrataci√≥n hiper/hiponatr√©mica, el Na+ del suero debe ser 15-30 mEq/L menor/mayor que la natremia del paciente.</li>
                        <li><strong>Ritmo de Correcci√≥n:</strong> Objetivo 0,5 mEq/L/hora (m√°x. 12 mEq/L/d√≠a). Ajustar suero seg√∫n controles.</li>
                        <li><strong>Hiponatremia Grave:</strong> Si Na+ &lt;120 mEq/L y/o convulsiones, valorar bolos de Salino 3% (2-5 ml/kg).</li>
                        <li><strong>Suero Preferente:</strong> <code>Salino 0,9%</code> + <code>Gluc 5%</code> + <code>K+ 20 mEq/L</code>, si cumple con la diferencia de concentraci√≥n de Na+.</li>
                        <li>
                            <strong>Concentraciones de Sodio en Sueros Modificados (seg√∫n se realice o no extracci√≥n previa del suero base del volumen de los componentes que se van a a√±adir):</strong>
                            <div class="sueros-table-container table-wrapper" style="margin-top: 10px;">
                                <table class="sueros-table">
                                    <thead>
                                        <tr>
                                            <th>Suero Base Inicial (Concentraci√≥n Na+)</th>
                                            <th>Componentes a√±adidos</th>
                                            <th>Concentraci√≥n Na+ (extracci√≥n previa de volumen)</th>
                                            <th>Concentraci√≥n Na+ (adici√≥n sin extracci√≥n previa)</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr><td>Salino 0,9% (154 mEq/L)</td><td>Glucosa 5 %<br>K+ 20 mEq/L</td><td>135,52 mEq/L</td><td>137,5 mEq/L</td></tr>
                                        <tr><td>Salino 0,9% + glucosa 5% (154 mEq/L)</td><td>K+ 20 mEq/L</td><td>150,92 mEq/L</td><td>150,98 mEq/L</td></tr>
                                        <tr><td>Salino 0,45% (77 mEq/L)</td><td>Glucosa 5 %<br>K+ 20 mEq/L</td><td>67,76 mEq/L</td><td>68,75 mEq/L</td></tr>
                                        <tr><td>Salino 0,45% + glucosa 5% (77 mEq/L)</td><td>K+ 20 mEq/L</td><td>75,46 mEq/L</td><td>75,49 mEq/L</td></tr>
                                        <tr><td>Ringer Lactato (130 mEq/L)</td><td>Glucosa 5 %<br>K+ 20 mEq/L</td><td>114,92 mEq/L</td><td>116,49 mEq/L</td></tr>
                                    </tbody>
                                </table>
                            </div>
                        </li>
                    </ul>
                </div>
                <div class="input-group"> 
                    <label for="concentracionSodioBase">Concentraci√≥n de sodio de mi suero base (mEq/L):</label>
                     <input type="number" id="concentracionSodioBase" step="0.1" min="0" class="custom-input-select">
                </div>
                <div class="input-group">
                    <label for="concentracionSodioDeseada">Concentraci√≥n de sodio deseada (mEq/L):</label>
                    <input type="number" id="concentracionSodioDeseada" step="0.1" min="0" class="custom-input-select">
                </div>
                <button class="btn" onclick="calcularSodio()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Sodio
                </button>
                <div id="resultado-sodio" class="result"></div>
                <p id="nota-sodio-resultados" class="nota-text" style="display: none; margin-top:15px;"><strong>NOTA ACERCA DE LOS RESULTADOS:</strong> El redondeo de las cent√©simas puede implicar una diferencia en la concentraci√≥n de sodio final variable, <1 mEq/L. Para este c√°lculo s√≠ se ha tenido en cuenta el aumento del volumen total del disolvente al a√±adir el suero salino al 20%, por lo que no ser√≠a necesario retirar del suero base el volumen de suero salino al 20% que se indica a√±adir para lograr la concentraci√≥n de sodio deseada.</p>
            </div>

            <div id="acidosis" class="tab-content">
                <div class="consideraciones-previas-container">
                    <h4 class="consideraciones-previas-title">CONSIDERACIONES PREVIAS</h4>
                     <ul>
                        <li><strong>Indicaci√≥n de Correcci√≥n:</strong> Valorar si pH &lt;7,15 - 7,20; EB &lt;-12 y/o HCO3 &lt;10-12 mEq/L.</li>
                        <li><strong>Casos L√≠mite:</strong> La propia rehidrataci√≥n suele mejorar la acidosis.</li>
                        <li><strong>Acidosis con Ani√≥n GAP Aumentado:</strong> Generalmente no se corrige, salvo pH &lt; 7,1 o hiperK+ grave.</li>
                        <li><strong>Ritmo de Reposici√≥n:</strong> Reponer ‚Öì o ¬Ω del d√©ficit en 1-2h. Opcional: ‚Öì m√°s en 24h.</li>
                        <li>
                            <strong>Opciones de Reposici√≥n (1-2h):</strong>
                            <ul>
                                <li>A√±adir Bicarbonato S√≥dico 1M al suero pautado (Ver c√°lculo abajo).</li>
                                <li>Usar Bicarbonato 1/6M inicial.</li>
                                <li>En rehidrataci√≥n intravenosa r√°pida, se podr√≠a emplear Ringer Lactato.</li>
                            </ul>
                        </li>
                        <li><strong>Precauci√≥n con Sodio:</strong> 1 ml de Bicarbonato S√≥dico 1M ‚âà 1 mEq de Na+.</li>
                    </ul>
                </div>
                <div class="input-group">
                    <label for="excesoBases">Exceso de bases (mEq/L):</label>
                    <input type="number" id="excesoBases" step="0.1" class="custom-input-select">
                </div>
                <div class="input-group">
                    <label>D√©ficit de bases que se repondr√°:</label>
                    <div class="radio-group">
                        <label><input type="radio" name="correccionAcidosis" value="1/3" checked> 1/3 del d√©ficit calculado</label>
                        <label><input type="radio" name="correccionAcidosis" value="1/2"> 1/2 del d√©ficit calculado</label>
                    </div>
                </div>
                <button class="btn" onclick="calcularAcidosis()">
                   <svg width="18" height="18" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" class="icon">
                        <rect x="4" y="2" width="16" height="20" rx="2" fill="#FFECB3"/>
                        <path d="M6 5H18V11H6V5Z" fill="#FFE082"/>
                        <rect x="7" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="13" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="7" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="16" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="14.5" y="16" width="2.5" height="2" rx="0.5" fill="#E65100"/>
                        <rect x="7" y="19" width="2.5" height="2" rx="0.5" fill="#FFA000"/>
                        <rect x="10.75" y="19" width="6.25" height="2" rx="0.5" fill="#E65100"/>
                    </svg>
                    Calcular Correcci√≥n de Acidosis
                </button>
                <div id="resultado-acidosis" class="result"></div>
            </div>
        </div>

        <div class="section">
            <h2 class="section-title">Pauta Final de Sueroterapia</h2>
            <div id="pauta-final" class="result"></div>
             <div id="pauta-final-copy-container" style="text-align: center; display: none; margin-top: 15px;">
                <button id="copyPautaBtn" class="btn">üìÑ Copiar Pauta</button>
            </div>
        </div>

        <div class="disclaimer-text">
            <p>Esta herramienta, desarrollada por David Tejero S√°nchez, pediatra en Madrid, mediante Gemini 2.5 Pro, busca facilitar los c√°lculos de sueroterapia para minimizar errores de prescripci√≥n. Su uso no exime al pediatra prescriptor de su responsabilidad final sobre el tratamiento del paciente y la correcta introducci√≥n de los datos requeridos. Las notas informativas proporcionadas, basadas en las gu√≠as cl√≠nicas nacionales m√°s recientes (a fecha de mayo de 2025), son solo orientativas y no sustituyen el criterio m√©dico. Se proh√≠be su copia o modificaci√≥n.</p>
        </div>
        <p class="version-text">FluidoPED beta 3.0</p>

    </div>

    <div id="deficit-warning-modal">
        <p>Volumen total a infundir calculado superior al d√©ficit de l√≠quidos que se ha estimado, valore reducir el tiempo de administraci√≥n de la rehidrataci√≥n r√°pida.</p>
        <button onclick="closeWarningModal()">Cerrar</button>
    </div>

    <div id="potassium-warning-modal">
        <p>Aporte de potasio >0,3 mEq/Kg/h, el paciente precisa de monitorizaci√≥n continua de ECG.</p>
        <button onclick="closeKWarningModal()">Cerrar</button>
    </div>

    <div id="copy-toast"></div>

    <script>
        // Funci√≥n para formatear n√∫meros para mostrar enteros si no hay decimales significativos, si no, 1 o 2 decimales
        function formatDecimal(num, precision = 1) {
            if (num === null || num === undefined) return '';
            const numFloat = parseFloat(num);
            if (numFloat % 1 === 0) { // Es un entero
                return numFloat.toString();
            }
            return numFloat.toFixed(precision);
        }

        // Funci√≥n para aplicar estilo de negrita y color a las etiquetas de radio/checkbox seleccionadas
        function updateLabelStyles(groupName) {
            const inputs = document.getElementsByName(groupName);
            inputs.forEach(input => {
                let label = input.closest('label'); 
                if (!label && input.id) { 
                    label = document.querySelector(`label[for="${input.id}"]`);
                }
                if (label) {
                    if (!label.classList.contains('volume-option')) { 
                        if (input.checked) {
                            label.classList.add('selected-option-text');
                        } else {
                            label.classList.remove('selected-option-text');
                        }
                    }
                }
            });
        }
        
        function resetAllCalculationsAndPauta() {
            const resultDivsIds = [
                'resultado-basales', 'resultado-rapida', 'resultado-clasica',
                'resultado-gorelick-clasica', 'resultado-gorelick-rapida', 'resultado-glucosa', 'resultado-potasio',
                'resultado-sodio', 'resultado-acidosis',
                'basales-clasica-display', 'resultado-deficit-rapida'
            ];
            resultDivsIds.forEach(id => {
                const div = document.getElementById(id);
                if (div) {
                    div.innerHTML = '';
                    div.classList.remove('show');
                    if(div.dataset.deficitCalculado) {
                        delete div.dataset.deficitCalculado;
                    }
                }
            });
            document.getElementById('deficit-warning-modal').style.display = 'none';
            document.getElementById('potassium-warning-modal').style.display = 'none';
            resetPautaFinal();
        }

        function resetPautaFinal() {
            const pautaFinalDiv = document.getElementById('pauta-final');
            pautaFinalDiv.innerHTML = '';
            pautaFinalDiv.classList.remove('show');
            Object.keys(pautaFinalDiv.dataset).forEach(key => delete pautaFinalDiv.dataset[key]);
            document.getElementById('pauta-final-copy-container').style.display = 'none';
        }

        function openTab(evt, tabName) {
            if (evt && evt.currentTarget && evt.currentTarget.classList.contains('disabled')) {
                return; 
            }
            var i, tabcontent, tablinks;
            tabcontent = document.getElementsByClassName("tab-content");
            for (i = 0; i < tabcontent.length; i++) {
                tabcontent[i].style.display = "none";
            }
            tablinks = document.getElementsByClassName("tab-button");
            for (i = 0; i < tablinks.length; i++) {
                tablinks[i].className = tablinks[i].className.replace(" active", "");
            }
            document.getElementById(tabName).style.display = "block";
            if (evt && evt.currentTarget) {
                evt.currentTarget.className += " active";
            } else {
                const button = document.querySelector(`.tab-button[onclick*="'${tabName}'"]`);
                if (button) {
                    button.className += " active";
                }
            }
        }

        function showModalidadOptions() {
            resetAllCalculationsAndPauta(); 
            const modalidad = document.getElementById('modalidad').value;
            const optionsDivs = document.getElementsByClassName('modalidad-options');
            const potasioTab = document.getElementById('potasio-tab');
            const sodioTab = document.getElementById('sodio-tab');
            const sueroBaseConGlucosaRadios = document.getElementsByName('sueroBaseConGlucosa');
            const sueroBaseConPotasioRadios = document.getElementsByName('sueroBaseConPotasio');
            const notaGlucosaRapida = document.getElementById('nota-glucosa-rapida');
            
            for (let i = 0; i < optionsDivs.length; i++) {
                optionsDivs[i].style.display = 'none';
            }
            
            notaGlucosaRapida.style.display = 'none';
            potasioTab.classList.remove('disabled');
            sodioTab.classList.remove('disabled');
            enableInputsInTab('potasio');
            enableInputsInTab('sodio');

            if (modalidad === 'basales') {
                sueroBaseConGlucosaRadios.forEach(radio => radio.value === 'true' ? radio.checked = true : radio.checked = false);
                sueroBaseConPotasioRadios.forEach(radio => radio.value === 'false' ? radio.checked = true : radio.checked = false);
            } else if (modalidad === 'rapida') {
                notaGlucosaRapida.innerHTML = '<strong>NOTA:</strong> En la rehidrataci√≥n intravenosa r√°pida, a√±adir glucosa al 2,5% si glucemia normal y cetosis. Tambi√©n puede a√±adirse (con menor grado de evidencia) cuando la glucemia y cetonemia son normales. Si glucemia >140 mg/dL, no a√±adir glucosa.';
                notaGlucosaRapida.style.display = 'block';
                sueroBaseConGlucosaRadios.forEach(radio => radio.value === 'false' ? radio.checked = true : radio.checked = false);
                sueroBaseConPotasioRadios.forEach(radio => radio.value === 'false' ? radio.checked = true : radio.checked = false);
                toggleDeficitCalculationMethod('rapida'); 
            } else if (modalidad === 'clasica') {
                 sueroBaseConGlucosaRadios.forEach(radio => radio.value === 'true' ? radio.checked = true : radio.checked = false);
                 sueroBaseConPotasioRadios.forEach(radio => radio.value === 'false' ? radio.checked = true : radio.checked = false);
                 toggleDeficitCalculationMethod('clasica');
            }

            updateLabelStyles('sueroBaseConGlucosa');
            updateLabelStyles('sueroBaseConPotasio');
            handleSueroBasePotasioChange(); 

            if (modalidad) {
                document.getElementById('modalidad-' + modalidad).style.display = 'block';
                if (modalidad === 'clasica') {
                    calcularBasales(true); 
                } else if (modalidad === 'rapida') {
                    potasioTab.classList.add('disabled');
                    sodioTab.classList.add('disabled');
                    disableInputsInTab('potasio');
                    disableInputsInTab('sodio');
                    const activeTabButton = document.querySelector('.tab-button.active');
                    if (activeTabButton && (activeTabButton.id === 'potasio-tab' || activeTabButton.id === 'sodio-tab')) {
                        openTab(null, 'glucosa');
                    }
                } else if (modalidad === 'basales') {
                    sodioTab.classList.add('disabled');
                    disableInputsInTab('sodio');
                    const activeTabButton = document.querySelector('.tab-button.active');
                    if (activeTabButton && activeTabButton.id === 'sodio-tab') {
                        openTab(null, 'glucosa');
                    }
                }
            }
            updatePautaFinal();
        }

        function disableInputsInTab(tabId) {
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
                const inputs = tabContent.querySelectorAll('input, select, button');
                inputs.forEach(input => input.disabled = true);
            }
        }

        function enableInputsInTab(tabId) {
            const tabContent = document.getElementById(tabId);
            if (tabContent) {
                const inputs = tabContent.querySelectorAll('input, select, button');
                inputs.forEach(input => input.disabled = false);
            }
        }

        function resetCalculator() {
            document.getElementById('peso').value = '';
            const volumenRadios = document.getElementsByName('volumenBolsa');
            volumenRadios.forEach(radio => radio.value === '500' ? radio.checked = true : radio.checked = false);
            updateVolumeButtonStyles();
            document.getElementById('modalidad').value = '';

            document.getElementById('fraccionNecesidadesBasales').value = '1';
            document.getElementById('tiempoRehidratacionRapida').value = '2';

            document.querySelector('input[name="expansionVolumen"][value="no"]').checked = true;
            document.getElementById('volumenExpansionMl').value = '';
            document.getElementById('volumenExpansionMl').style.display = 'none';
            document.getElementById('porcentajeDeshidratacion').value = '';
            document.querySelector('input[name="perdidasMantenidas"][value="0"]').checked = true;
            document.getElementById('perdidasMantenidasValor').value = '';
            document.getElementById('perdidasMantenidasValor').style.display = 'none';
            document.querySelector('input[name="correccionDeficit"][value="1"]').checked = true;

            document.querySelector('input[name="sueroBaseConGlucosa"][value="false"]').checked = true;
            document.getElementById('concentracionGlucosa').value = '';
            document.querySelector('input[name="unidadGlucosa"][value="mg/kg/min"]').checked = true;
            document.querySelector('input[name="sueroBaseConPotasio"][value="false"]').checked = true;
            handleSueroBasePotasioChange();
            document.querySelector('input[name="concentracionPotasio"][value="none"]').checked = true;
            document.getElementById('formaPotasio').value = "Cloruro pot√°sico";
            document.getElementById('concentracionSodioDeseada').value = '';
            document.getElementById('concentracionSodioBase').value = '';
            document.getElementById('excesoBases').value = '';
            document.querySelector('input[name="correccionAcidosis"][value="1/3"]').checked = true;
            
            document.querySelector('input[name="pesoCuantificado"][value="no"]').checked = true;
            document.getElementById('pesoPerdido').value = '';
            document.getElementById('porcentajeDeshidratacionRapida').value = '';
            document.querySelector('input[name="pesoCuantificadoClasica"][value="no"]').checked = true;
            document.getElementById('pesoPerdidoClasica').value = '';

            const radioCheckboxGroups = [
                'expansionVolumen', 'perdidasMantenidas', 'correccionDeficit', 
                'sueroBaseConGlucosa', 'unidadGlucosa', 'sueroBaseConPotasio', 
                'concentracionPotasio', 'correccionAcidosis', 'pesoCuantificado', 'pesoCuantificadoClasica'
            ];
            radioCheckboxGroups.forEach(groupName => updateLabelStyles(groupName));
             
            document.querySelectorAll('input[name^="gorelick"]').forEach(cb => {
                cb.checked = false;
                 const label = cb.closest('label');
                 if(label) label.classList.remove('selected-option-text');
            });
            document.getElementById('nota-glucosa-rapida').style.display = 'none';

            showModalidadOptions(); 
            openTab(null, 'glucosa');
            
            toggleDeficitCalculationMethod('rapida');
            toggleDeficitCalculationMethod('clasica');
        }

        function updateVolumeButtonStyles() {
            const labels = document.querySelectorAll('#volumenBolsaOptions label.volume-option');
            labels.forEach(label => {
                const radio = label.querySelector('input[type="radio"]');
                if (radio.checked) {
                    label.classList.add('selected');
                } else {
                    label.classList.remove('selected');
                }
            });
        }
        
        function getSelectedVolumeBolsa() {
            const selectedRadio = document.querySelector('#volumenBolsaOptions input[name="volumenBolsa"]:checked');
            return selectedRadio ? parseFloat(selectedRadio.value) : 500; 
        }

        function calcularBasales(isClassic = false) {
            const peso = parseFloat(document.getElementById('peso').value);
            const fraccionNecesidadesSelect = document.getElementById('fraccionNecesidadesBasales');
            const fraccionNecesidadesValue = fraccionNecesidadesSelect.value;
            const fraccionNecesidadesText = fraccionNecesidadesSelect.options[fraccionNecesidadesSelect.selectedIndex].text;

            const resultadoDiv = isClassic ? document.getElementById('basales-clasica-display') : document.getElementById('resultado-basales');
            const pautaFinalDataset = document.getElementById('pauta-final').dataset;

            delete pautaFinalDataset.fraccionBasalDesc; 

            if (isNaN(peso) || peso <= 0) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un peso v√°lido.</strong>';
                resultadoDiv.classList.add('show');
                delete pautaFinalDataset.volumenBasal;
                delete pautaFinalDataset.ritmoBasal;
                if (isClassic) {
                    delete resultadoDiv.dataset.volumenBasal;
                    delete resultadoDiv.dataset.ritmoBasal;
                }
                updatePautaFinal();
                return;
            }

            let volumenTotal24hOriginal;
            if (peso <= 10) {
                volumenTotal24hOriginal = peso * 100;
            } else if (peso <= 20) {
                volumenTotal24hOriginal = 1000 + (peso - 10) * 50;
            } else {
                volumenTotal24hOriginal = 1500 + (peso - 20) * 20;
            }

            let factorFraccion = 1;
            let fraccionDesc = fraccionNecesidadesText; 
            if (fraccionNecesidadesValue === "2/3") {
                factorFraccion = 2/3;
            } else if (fraccionNecesidadesValue === "1/2") {
                factorFraccion = 1/2;
            } else if (fraccionNecesidadesValue === "1/3") {
                factorFraccion = 1/3;
            }


            let volumenTotal24h = volumenTotal24hOriginal * factorFraccion;
            let volumenTotal24hDisplay = volumenTotal24h;
            let maxVolReached = false;
            if (volumenTotal24hDisplay > (2400 * factorFraccion) && factorFraccion === 1) { 
                 volumenTotal24hDisplay = 2400;
                 maxVolReached = true;
            } else if (volumenTotal24hDisplay > 2400 && factorFraccion === 1) { 
                 volumenTotal24hDisplay = 2400;
                 maxVolReached = true;
            }

            let ritmoInfusion = volumenTotal24hDisplay / 24;
            let ritmoInfusionDisplay = ritmoInfusion;
            let maxRitmoReached = false;
             if (ritmoInfusionDisplay > (100 * factorFraccion) && factorFraccion === 1) { 
                ritmoInfusionDisplay = 100;
                maxRitmoReached = true;
            } else if (ritmoInfusionDisplay > 100 && factorFraccion === 1) { 
                ritmoInfusionDisplay = 100;
                maxRitmoReached = true;
            }

            if (maxRitmoReached && factorFraccion === 1) {
                volumenTotal24hDisplay = ritmoInfusionDisplay * 24;
                if (volumenTotal24hDisplay > 2400) volumenTotal24hDisplay = 2400;
                maxVolReached = true;
            }

            pautaFinalDataset.fraccionBasalDesc = fraccionDesc;

            const volDisplayRounded = Math.round(volumenTotal24hDisplay);
            const ritmoDisplayRounded = Math.round(ritmoInfusionDisplay);

            let resultHTML = `
                <strong>Necesidades Basales (${fraccionDesc}):</strong><br>
                Volumen total a infundir en 24 horas: ${volDisplayRounded} ml ${maxVolReached ? '(M√°x. 2400 ml/d√≠a)' : ''}<br>
                Ritmo de infusi√≥n: ${ritmoDisplayRounded} ml/h ${maxRitmoReached ? '(M√°x. 100 ml/h)' : ''}
            `;
            resultadoDiv.innerHTML = resultHTML;
            resultadoDiv.classList.add('show');

            if (isClassic) {
                resultadoDiv.dataset.volumenBasal = volDisplayRounded;
                resultadoDiv.dataset.ritmoBasal = ritmoDisplayRounded;
                resultadoDiv.dataset.fraccionBasalDesc = fraccionDesc;
            } else {
                pautaFinalDataset.volumenBasal = volDisplayRounded;
                pautaFinalDataset.ritmoBasal = ritmoDisplayRounded;
            }
            updatePautaFinal();
        }

        function closeWarningModal() {
            document.getElementById('deficit-warning-modal').style.display = 'none';
        }

        function closeKWarningModal() {
             document.getElementById('potassium-warning-modal').style.display = 'none';
        }

        function calcularRapida() {
            document.getElementById('deficit-warning-modal').style.display = 'none'; // Reset modal
            const peso = parseFloat(document.getElementById('peso').value);
            const tiempoRehidratacionHoras = parseInt(document.getElementById('tiempoRehidratacionRapida').value);
            const resultadoDiv = document.getElementById('resultado-rapida');
            const pautaFinalDataset = document.getElementById('pauta-final').dataset;

            if (isNaN(peso) || peso <= 0) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un peso v√°lido.</strong>';
                resultadoDiv.classList.add('show');
                delete pautaFinalDataset.volumenRapida;
                delete pautaFinalDataset.ritmoRapida;
                delete pautaFinalDataset.tiempoRehidratacionRapidaDesc;
                updatePautaFinal();
                return;
            }

            let ritmoInfusionBase = peso * 20;
            let ritmoInfusionDisplay = ritmoInfusionBase;
            let maxRitmoReached = false;

            if (ritmoInfusionBase > 700) {
                ritmoInfusionDisplay = 700;
                maxRitmoReached = true;
            }

            let volumenTotalInfusion = ritmoInfusionDisplay * tiempoRehidratacionHoras;

            const ritmoDisplayRounded = Math.round(ritmoInfusionDisplay);
            const volTotalRounded = Math.round(volumenTotalInfusion);
            const horasTexto = tiempoRehidratacionHoras === 1 ? 'hora' : 'horas';

            const deficitDiv = document.getElementById('resultado-deficit-rapida');
            const deficitCalculado = deficitDiv.dataset.deficitCalculado ? parseFloat(deficitDiv.dataset.deficitCalculado) : null;
            
            if(deficitCalculado !== null && volTotalRounded > deficitCalculado) {
                 document.getElementById('deficit-warning-modal').style.display = 'flex';
            }

            let resultHTML = `
                <strong>Rehidrataci√≥n Intravenosa R√°pida:</strong><br>
                Ritmo de infusi√≥n: ${ritmoDisplayRounded} ml/h ${maxRitmoReached ? '(M√°x. 700 ml/h alcanzado)' : '(20 ml/kg/h)'}<br>
                Volumen total a infundir en ${tiempoRehidratacionHoras} ${horasTexto}: ${volTotalRounded} ml
            `;
            resultadoDiv.innerHTML = resultHTML;
            resultadoDiv.classList.add('show');
            pautaFinalDataset.volumenRapida = volTotalRounded;
            pautaFinalDataset.ritmoRapida = ritmoDisplayRounded;
            pautaFinalDataset.tiempoRehidratacionRapidaDesc = `${tiempoRehidratacionHoras} ${horasTexto}`;
            updatePautaFinal();
        }

        function calcularClasica() {
            const peso = parseFloat(document.getElementById('peso').value);
            const perdidasMantenidasRadio = document.querySelector('input[name="perdidasMantenidas"]:checked').value;
            const perdidasMantenidasValorInput = document.getElementById('perdidasMantenidasValor');
            const perdidasMantenidasValor = parseFloat(perdidasMantenidasValorInput.value);
            const correccionDeficitRadio = document.querySelector('input[name="correccionDeficit"]:checked').value;

            const expansionAdministrada = document.querySelector('input[name="expansionVolumen"]:checked').value === 'si';
            const volumenExpansionMlInput = document.getElementById('volumenExpansionMl');
            let volumenExpansion = 0;
            if (expansionAdministrada) {
                volumenExpansion = parseFloat(volumenExpansionMlInput.value);
                if (isNaN(volumenExpansion) || volumenExpansion < 0) {
                     document.getElementById('resultado-clasica').innerHTML = '<strong style="color: red;">Por favor, ingrese un volumen de expansi√≥n v√°lido.</strong>';
                     document.getElementById('resultado-clasica').classList.add('show');
                     updatePautaFinal();
                    return;
                }
            }

            const resultadoDiv = document.getElementById('resultado-clasica');
            const basalesClasicaDiv = document.getElementById('basales-clasica-display');
            const pautaFinalDataset = document.getElementById('pauta-final').dataset;
            
            let deficitLiquidos = 0;
            const isPesoCuantificado = document.querySelector('input[name="pesoCuantificadoClasica"]:checked').value === 'si';

            if (isPesoCuantificado) {
                const pesoPerdido = parseFloat(document.getElementById('pesoPerdidoClasica').value);
                if (isNaN(pesoPerdido) || pesoPerdido <= 0) {
                    resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un peso perdido v√°lido para el c√°lculo de d√©ficit.</strong>';
                    resultadoDiv.classList.add('show');
                    updatePautaFinal();
                    return;
                }
                deficitLiquidos = pesoPerdido * 1000;
            } else {
                 const porcentajeDeshidratacion = parseFloat(document.getElementById('porcentajeDeshidratacion').value);
                 if (isNaN(porcentajeDeshidratacion) || porcentajeDeshidratacion < 0) {
                    resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un porcentaje de deshidrataci√≥n v√°lido para el c√°lculo de d√©ficit.</strong>';
                    resultadoDiv.classList.add('show');
                    updatePautaFinal();
                    return;
                }
                deficitLiquidos = porcentajeDeshidratacion * 10 * peso;
            }


            calcularBasales(true);
            const volumenBasal = parseFloat(basalesClasicaDiv.dataset.volumenBasal);
            const ritmoBasal = parseFloat(basalesClasicaDiv.dataset.ritmoBasal);
            const fraccionBasalDescClasica = basalesClasicaDiv.dataset.fraccionBasalDesc || "Necesidades Basales Completas";

            if (isNaN(peso) || peso <= 0) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, complete los datos del paciente.</strong>';
                resultadoDiv.classList.add('show');
                delete pautaFinalDataset.volumenClasica;
                delete pautaFinalDataset.ritmoClasica;
                updatePautaFinal();
                return;
            }
            if (isNaN(volumenBasal) || isNaN(ritmoBasal)) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Error al obtener necesidades basales. Por favor, aseg√∫rese de que el peso es correcto y vuelva a seleccionar la modalidad "Cl√°sica".</strong>';
                resultadoDiv.classList.add('show');
                delete pautaFinalDataset.volumenClasica;
                delete pautaFinalDataset.ritmoClasica;
                updatePautaFinal();
                return;
            }

            let perdidasMantenidasCalculated = 0;
            if (perdidasMantenidasRadio === 'quantified') {
                if (isNaN(perdidasMantenidasValor) || perdidasMantenidasValor < 0) {
                    resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un valor v√°lido para las p√©rdidas mantenidas cuantificadas.</strong>';
                    resultadoDiv.classList.add('show');
                    delete pautaFinalDataset.volumenClasica;
                    delete pautaFinalDataset.ritmoClasica;
                    updatePautaFinal();
                    return;
                }
                perdidasMantenidasCalculated = perdidasMantenidasValor * peso;
            }

            let correccionFactor;
            if (correccionDeficitRadio === '1') correccionFactor = 1;
            else if (correccionDeficitRadio === '2/3') correccionFactor = 2 / 3;
            else if (correccionDeficitRadio === '1/3') correccionFactor = 1 / 3;
            else correccionFactor = 1;

            const deficitToReplace = deficitLiquidos * correccionFactor;
            let volumenTotal24h = volumenBasal + deficitToReplace + perdidasMantenidasCalculated;
            if (volumenExpansion > 0) {
                volumenTotal24h -= volumenExpansion;
                if (volumenTotal24h < 0) volumenTotal24h = 0;
            }

            const ritmoInfusion24h = volumenTotal24h > 0 ? volumenTotal24h / 24 : 0;
            const volTotalRounded = Math.round(volumenTotal24h);
            const ritmoInfusionRounded = Math.round(ritmoInfusion24h);

            let resultHTML = `
                <strong>Rehidrataci√≥n Intravenosa Cl√°sica:</strong><br>
                Necesidades Basales (${fraccionBasalDescClasica}): ${Math.round(volumenBasal)} ml/24h (${Math.round(ritmoBasal)} ml/h)<br>
                D√©ficit de l√≠quidos calculado: ${formatDecimal(deficitLiquidos, 0)} ml<br>
                P√©rdidas mantenidas estimadas: ${formatDecimal(perdidasMantenidasCalculated, 0)} ml/d√≠a<br>`;
            if (volumenExpansion > 0) {
                 resultHTML += `Volumen de expansi√≥n o RIV r√°pida previa restado: ${formatDecimal(volumenExpansion, 0)} ml<br>`;
            }
            resultHTML += `Volumen total a reponer en 24 horas: ${volTotalRounded} ml<br>
                Ritmo de infusi√≥n en 24 horas: ${ritmoInfusionRounded} ml/h
            `;
            resultadoDiv.innerHTML = resultHTML;
            resultadoDiv.classList.add('show');
            pautaFinalDataset.volumenClasica = volTotalRounded;
            pautaFinalDataset.ritmoClasica = ritmoInfusionRounded;
            resultadoDiv.dataset.ritmoClasica = ritmoInfusionRounded;
            pautaFinalDataset.fraccionBasalDescClasica = fraccionBasalDescClasica;
            updatePautaFinal();
        }

        function calcularGlucosa() {
            const peso = parseFloat(document.getElementById('peso').value);
            const volumenBolsa = getSelectedVolumeBolsa();
            const concentracionDeseadaInput = document.getElementById('concentracionGlucosa').value;
            const concentracionDeseada = concentracionDeseadaInput === '' ? null : parseFloat(concentracionDeseadaInput);
            const unidadGlucosa = document.querySelector('input[name="unidadGlucosa"]:checked').value;
            const sueroBaseTieneGlucosa = document.querySelector('input[name="sueroBaseConGlucosa"]:checked').value === 'true';

            const resultadoDiv = document.getElementById('resultado-glucosa');
            const pautaFinalData = document.getElementById('pauta-final').dataset;

            delete pautaFinalData.glucosaGR50;
            delete pautaFinalData.glucosaAporte;
            delete pautaFinalData.glucosaUnidad;
            delete pautaFinalData.glucosaMensajeAdicional;
            delete pautaFinalData.glucosaConcentracionDeseada;


            let ritmoInfusion = 0;
            const modalidad = document.getElementById('modalidad').value;
            if (modalidad === 'basales' && pautaFinalData.ritmoBasal) {
                ritmoInfusion = parseFloat(pautaFinalData.ritmoBasal);
            } else if (modalidad === 'rapida' && pautaFinalData.ritmoRapida) {
                ritmoInfusion = parseFloat(pautaFinalData.ritmoRapida);
            } else if (modalidad === 'clasica') {
                const clasicaResultDiv = document.getElementById('resultado-clasica');
                if (clasicaResultDiv.dataset.ritmoClasica) {
                     ritmoInfusion = parseFloat(clasicaResultDiv.dataset.ritmoClasica);
                } else if (pautaFinalData.ritmoClasica) {
                    ritmoInfusion = parseFloat(pautaFinalData.ritmoClasica);
                }
            }

            if (isNaN(peso) || peso <= 0 || isNaN(volumenBolsa) || volumenBolsa <= 0 ) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, complete los datos del paciente.</strong>';
                resultadoDiv.classList.add('show');
                updatePautaFinal();
                return;
            }
             if (ritmoInfusion <= 0 || isNaN(ritmoInfusion)) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Calcule primero la modalidad de sueroterapia para obtener el ritmo de infusi√≥n.</strong>';
                resultadoDiv.classList.add('show');
                updatePautaFinal();
                return;
            }

            const C_BASE_GLUCOSA = 5.0; 
            const C_GR50 = 50.0;       
            let volumenGR50 = 0;
            let mensajeAdicional = "";
            let concentracionParaAportes = sueroBaseTieneGlucosa ? C_BASE_GLUCOSA : 0;
            let concentracionFinalMostrada = concentracionParaAportes;


            if (concentracionDeseada !== null) {
                 if (isNaN(concentracionDeseada) || concentracionDeseada < 0) {
                    resultadoDiv.innerHTML = '<strong style="color: red;">Ingrese una concentraci√≥n de glucosa deseada v√°lida.</strong>';
                    resultadoDiv.classList.add('show');
                    updatePautaFinal();
                    return;
                 }
                concentracionParaAportes = concentracionDeseada;
                concentracionFinalMostrada = concentracionDeseada;
                pautaFinalData.glucosaConcentracionDeseada = formatDecimal(concentracionDeseada);


                if (sueroBaseTieneGlucosa) {
                    if (concentracionDeseada <= C_BASE_GLUCOSA) {
                        volumenGR50 = 0;
                        mensajeAdicional = `El suero base ya tiene ${C_BASE_GLUCOSA}% de glucosa.`;
                        concentracionFinalMostrada = C_BASE_GLUCOSA; 
                        pautaFinalData.glucosaConcentracionDeseada = formatDecimal(C_BASE_GLUCOSA);
                        if (concentracionDeseada < C_BASE_GLUCOSA) {
                             mensajeAdicional += ` No se puede reducir a√±adiendo GR50.`;
                        } else {
                             mensajeAdicional += ` No se necesita a√±adir GR50.`;
                        }
                    } else {
                        volumenGR50 = ((concentracionDeseada - C_BASE_GLUCOSA) * volumenBolsa) / (C_GR50 - C_BASE_GLUCOSA);
                    }
                } else {
                    if (concentracionDeseada > 0) {
                        volumenGR50 = (concentracionDeseada * volumenBolsa) / C_GR50;
                    } else {
                        volumenGR50 = 0;
                         concentracionFinalMostrada = 0;
                         pautaFinalData.glucosaConcentracionDeseada = "0";
                    }
                }
            } else { 
                if (sueroBaseTieneGlucosa) {
                    volumenGR50 = 0;
                    mensajeAdicional = "Calculando aportes con glucosa base al 5%.";
                    concentracionParaAportes = C_BASE_GLUCOSA;
                    concentracionFinalMostrada = C_BASE_GLUCOSA;
                    pautaFinalData.glucosaConcentracionDeseada = formatDecimal(C_BASE_GLUCOSA);
                } else {
                     resultadoDiv.innerHTML = '<strong>C√°lculo de Glucosa:</strong><br>No se ha especificado concentraci√≥n deseada y el suero base no tiene glucosa. No hay aportes de glucosa.';
                    resultadoDiv.classList.add('show');
                    pautaFinalData.glucosaMensajeAdicional = 'Sin aportes de glucosa.';
                    updatePautaFinal();
                    return;
                }
            }

            const aporteMgKgMin = (concentracionParaAportes * ritmoInfusion) / (peso * 6);
            let aporteGlucosaCalculado = (unidadGlucosa === 'mg/kg/min') ? aporteMgKgMin : aporteMgKgMin * 0.06; 
            let aporteGlucosaUnit = (unidadGlucosa === 'mg/kg/min') ? 'mg/kg/min' : 'g/kg/h';

            let resultHTML = '<strong>C√°lculo de Glucosa:</strong><br>';
            if (volumenGR50 > 0) {
                resultHTML += `A√±adir ${formatDecimal(volumenGR50)} ml de GR50 a cada ${formatDecimal(volumenBolsa, 0)} ml del suero pautado.<br>`;
            } else if (mensajeAdicional && concentracionDeseada !== null) { 
                resultHTML += `${mensajeAdicional}<br>`;
            }
             if (concentracionDeseada !== null || sueroBaseTieneGlucosa) { 
                resultHTML += `Concentraci√≥n de glucosa: ${formatDecimal(concentracionFinalMostrada)} %<br>`;
            }
            resultHTML += `Aportes de Glucosa: ${formatDecimal(aporteGlucosaCalculado)} ${aporteGlucosaUnit}`;

            resultadoDiv.innerHTML = resultHTML;
            resultadoDiv.classList.add('show');

            pautaFinalData.glucosaGR50 = formatDecimal(volumenGR50);
            pautaFinalData.glucosaAporte = formatDecimal(aporteGlucosaCalculado);
            pautaFinalData.glucosaUnidad = aporteGlucosaUnit;
            if (mensajeAdicional && volumenGR50 <= 0 && concentracionDeseada !== null) {
                 pautaFinalData.glucosaMensajeAdicional = mensajeAdicional;
            }
            updatePautaFinal();
        }

        function calcularPotasio() {
            document.getElementById('potassium-warning-modal').style.display = 'none'; // Reset modal
            const peso = parseFloat(document.getElementById('peso').value);
            const volumenBolsa = getSelectedVolumeBolsa();
            const sueroBaseConPotasioValue = document.querySelector('input[name="sueroBaseConPotasio"]:checked').value;
            const concentracionDeseadaValue = document.querySelector('input[name="concentracionPotasio"]:checked').value;
            const formaAdministracion = document.getElementById('formaPotasio').value; 

            const resultadoDiv = document.getElementById('resultado-potasio');
            const pautaFinalData = document.getElementById('pauta-final').dataset;

            delete pautaFinalData.potasioVolumenToAdd;
            delete pautaFinalData.potasioForma;
            delete pautaFinalData.potasioConcentracionFinalSuero;
            delete pautaFinalData.potasioAporte_mEq_kg_h;
            delete pautaFinalData.potasioMensaje;
            delete pautaFinalData.potasioDecision;
            delete pautaFinalData.sueroBaseTienePotasio;
            delete pautaFinalData.potasioConcentracionDeseada;


            if (isNaN(peso) || peso <= 0 || isNaN(volumenBolsa) || volumenBolsa <= 0) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, complete los datos del paciente.</strong>';
                resultadoDiv.classList.add('show');
                updatePautaFinal();
                return;
            }

            let ritmoInfusion = 0;
            const modalidad = document.getElementById('modalidad').value;
            if (modalidad === 'basales' && pautaFinalData.ritmoBasal) ritmoInfusion = parseFloat(pautaFinalData.ritmoBasal);
            else if (modalidad === 'rapida' && pautaFinalData.ritmoRapida) ritmoInfusion = parseFloat(pautaFinalData.ritmoRapida);
            else if (modalidad === 'clasica') {
                const clasicaResultDiv = document.getElementById('resultado-clasica');
                if (clasicaResultDiv.dataset.ritmoClasica) ritmoInfusion = parseFloat(clasicaResultDiv.dataset.ritmoClasica);
                else if (pautaFinalData.ritmoClasica) ritmoInfusion = parseFloat(pautaFinalData.ritmoClasica);
            }

            const C_BASE_POTASIO_NB = 20.0; 
            const C_BASE_POTASIO_RL = 4.0;  
            let concentracionPotasioBase = 0;
            if (sueroBaseConPotasioValue === 'true') {
                concentracionPotasioBase = C_BASE_POTASIO_NB;
            } else if (sueroBaseConPotasioValue === 'ringer') {
                concentracionPotasioBase = C_BASE_POTASIO_RL;
            }

            let volumenToAdd = 0;
            let concentracionFinalParaCalculoAportes = 0;
            let concentracionDeseadaMostrada = 0;
            let mensajeResultadoPotasio = '<strong>C√°lculo de Potasio:</strong><br>';
            let aporteCalculado = null;

            if (concentracionDeseadaValue === 'none') {
                concentracionFinalParaCalculoAportes = concentracionPotasioBase;
                concentracionDeseadaMostrada = concentracionPotasioBase;
                mensajeResultadoPotasio += "Sin a√±adir potasio adicional.";
                if (sueroBaseConPotasioValue !== 'false') {
                    mensajeResultadoPotasio += ` Se utilizar√° la concentraci√≥n base.<br>`;
                } else {
                    mensajeResultadoPotasio += `<br>`;
                }
                 pautaFinalData.potasioConcentracionDeseada = formatDecimal(concentracionDeseadaMostrada, 0);
            } else {
                const concentracionDeseadaNum = parseFloat(concentracionDeseadaValue);
                concentracionFinalParaCalculoAportes = concentracionDeseadaNum;
                concentracionDeseadaMostrada = concentracionDeseadaNum;
                pautaFinalData.potasioConcentracionDeseada = formatDecimal(concentracionDeseadaNum, 0);


                if (concentracionDeseadaNum < concentracionPotasioBase) {
                    mensajeResultadoPotasio += `La concentraci√≥n deseada (${concentracionDeseadaNum} mEq/L) es inferior a la del suero base (${concentracionPotasioBase.toFixed(0)} mEq/L). No se a√±adir√° potasio. Se mantendr√° la concentraci√≥n base.<br>`;
                    concentracionFinalParaCalculoAportes = concentracionPotasioBase;
                    concentracionDeseadaMostrada = concentracionPotasioBase; 
                     pautaFinalData.potasioConcentracionDeseada = formatDecimal(concentracionPotasioBase, 0);
                } else if (concentracionDeseadaNum === concentracionPotasioBase) {
                    mensajeResultadoPotasio += `La concentraci√≥n deseada (${concentracionDeseadaNum} mEq/L) es igual a la del suero base. No se necesita a√±adir potasio.<br>`;
                } else {
                    volumenToAdd = ((concentracionDeseadaNum - concentracionPotasioBase) / 1000) * volumenBolsa;
                    mensajeResultadoPotasio += `A√±adir ${formatDecimal(volumenToAdd)} ml de ${formaAdministracion}.<br>`;
                }
            }
            
            if (concentracionDeseadaValue !== 'none' || sueroBaseConPotasioValue !== 'false') {
                 mensajeResultadoPotasio += `Concentraci√≥n de potasio: ${formatDecimal(concentracionDeseadaMostrada, 0)} mEq/L<br>`;
            }


            if (ritmoInfusion > 0 && peso > 0 && concentracionFinalParaCalculoAportes >= 0) {
                aporteCalculado = (concentracionFinalParaCalculoAportes / 1000) * ritmoInfusion / peso;
                mensajeResultadoPotasio += `Aporte de potasio: ${formatDecimal(aporteCalculado, 2)} mEq/kg/h`;
                pautaFinalData.potasioAporte_mEq_kg_h = formatDecimal(aporteCalculado, 2);
                 if(aporteCalculado > 0.3) {
                    document.getElementById('potassium-warning-modal').style.display = 'flex';
                }
            } else if (ritmoInfusion <= 0 && concentracionFinalParaCalculoAportes > 0) {
                 mensajeResultadoPotasio += "<br>Calcule primero la modalidad de sueroterapia para determinar el aporte de potasio.";
            } 

            resultadoDiv.innerHTML = mensajeResultadoPotasio;
            resultadoDiv.classList.add('show');

            pautaFinalData.potasioVolumenToAdd = formatDecimal(volumenToAdd);
            pautaFinalData.potasioForma = formaAdministracion;
            pautaFinalData.potasioConcentracionFinalSuero = formatDecimal(concentracionFinalParaCalculoAportes, 0); 
            pautaFinalData.potasioDecision = concentracionDeseadaValue;
            pautaFinalData.sueroBaseTienePotasio = sueroBaseConPotasioValue;
            if (volumenToAdd <= 0 && concentracionDeseadaValue !== 'none' && !(parseFloat(concentracionDeseadaValue) === concentracionPotasioBase)) { 
                 pautaFinalData.potasioMensaje = mensajeResultadoPotasio.split('<br>')[1] || mensajeResultadoPotasio.split('<br>')[0];
            }
            updatePautaFinal();
        }

        function calcularSodio() {
            const peso = parseFloat(document.getElementById('peso').value);
            const volumenBolsa = getSelectedVolumeBolsa();
            const concentracionDeseada = parseFloat(document.getElementById('concentracionSodioDeseada').value);
            const Cbase = parseFloat(document.getElementById('concentracionSodioBase').value); 

            const resultadoDiv = document.getElementById('resultado-sodio');
            const notaSodioDiv = document.getElementById('nota-sodio-resultados'); 
            const pautaFinalData = document.getElementById('pauta-final').dataset;

            delete pautaFinalData.sodioVolumenAdd; delete pautaFinalData.sodioNota; delete pautaFinalData.sodioBaseDesc; delete pautaFinalData.sodioConcentracionBase;
            delete pautaFinalData.sodioConcentracionDeseada;


            if (isNaN(peso) || peso <= 0 || isNaN(volumenBolsa) || volumenBolsa <= 0 || isNaN(concentracionDeseada) || concentracionDeseada < 0 || isNaN(Cbase) || Cbase < 0) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, complete todos los datos de sodio (peso, vol. bolsa, Na deseado, Na base).</strong>';
                resultadoDiv.classList.add('show');
                if (notaSodioDiv) notaSodioDiv.style.display = 'none';
                updatePautaFinal();
                return;
            }

            const CNaCl20 = 3400; 
            const Vbase_calculo = volumenBolsa;
            const CfinalDeseada = concentracionDeseada;
            
            let resultHTML = '<strong>C√°lculo de Sodio:</strong><br>';
            let volumenNaCl20 = 0;
            let concentracionFinalMostradaSodio = CfinalDeseada;


            if (CfinalDeseada <= Cbase) {
                const nota = `La concentraci√≥n deseada (${formatDecimal(CfinalDeseada)}) es igual o inferior a la del suero base (${formatDecimal(Cbase, 0)}). No se requiere a√±adir Suero Salino al 20%.`;
                resultHTML += `<strong style="color: orange;">${nota}</strong><br>`;
                pautaFinalData.sodioVolumenAdd = '0'; pautaFinalData.sodioNota = nota; 
                pautaFinalData.sodioConcentracionBase = formatDecimal(Cbase, 0);
                concentracionFinalMostradaSodio = Cbase; 
            } else if (CfinalDeseada >= CNaCl20) {
                 const nota = `Concentraci√≥n deseada (${formatDecimal(CfinalDeseada)}) inalcanzable con Suero Salino al 20% (${formatDecimal(CNaCl20, 0)}).`;
                resultHTML += `<strong style="color: red;">${nota}</strong><br>`;
                pautaFinalData.sodioVolumenAdd = 'Error'; pautaFinalData.sodioNota = nota;
                 pautaFinalData.sodioConcentracionBase = formatDecimal(Cbase, 0);
            } else {
                volumenNaCl20 = Vbase_calculo * (CfinalDeseada - Cbase) / (CNaCl20 - CfinalDeseada);
                resultHTML += `A√±adir ${formatDecimal(volumenNaCl20)} ml de Suero Salino al 20% a cada ${formatDecimal(volumenBolsa, 0)} ml del suero base.<br>`;
                pautaFinalData.sodioVolumenAdd = formatDecimal(volumenNaCl20); pautaFinalData.sodioNota = ''; 
                pautaFinalData.sodioConcentracionBase = formatDecimal(Cbase, 0);
            }
            
            resultHTML += `Concentraci√≥n de sodio: ${formatDecimal(concentracionFinalMostradaSodio)} mEq/L`;
            pautaFinalData.sodioConcentracionDeseada = formatDecimal(concentracionFinalMostradaSodio);


            resultadoDiv.innerHTML = resultHTML;
            resultadoDiv.classList.add('show');
            if (notaSodioDiv) notaSodioDiv.style.display = 'block';
            updatePautaFinal();
        }

        function calcularAcidosis() {
            const peso = parseFloat(document.getElementById('peso').value);
            const excesoBasesInput = document.getElementById('excesoBases').value;
            const correccionAcidosisRadio = document.querySelector('input[name="correccionAcidosis"]:checked');
            const correccionAcidosis = correccionAcidosisRadio ? correccionAcidosisRadio.value : "1/3"; 
            const resultadoDiv = document.getElementById('resultado-acidosis');
            const pautaFinalData = document.getElementById('pauta-final').dataset;

            delete pautaFinalData.acidosisVolumenNaHCO3;
            delete pautaFinalData.acidosisCorreccionFactor;
            delete pautaFinalData.acidosisDeficitBases;
            delete pautaFinalData.acidosisDeficitToReplace;
            delete pautaFinalData.acidosisDistribucionMsg;
            delete pautaFinalData.acidosisFractionText;


            if (isNaN(peso) || peso <= 0 || excesoBasesInput.trim() === '') {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, complete datos del paciente y exceso de bases.</strong>';
                resultadoDiv.classList.add('show'); return;
            }
            const excesoBases = parseFloat(excesoBasesInput);
            if (isNaN(excesoBases)) {
                 resultadoDiv.innerHTML = '<strong style="color: red;">Valor de exceso de bases no v√°lido.</strong>';
                 resultadoDiv.classList.add('show'); return;
            }

            const deficitBases = Math.abs(excesoBases * peso * 0.3);
            let correccionFactorValue = (correccionAcidosis === '1/3') ? 1/3 : 1/2;
            let fractionText = (correccionAcidosis === '1/3') ? "1/3 del calculado" : "1/2 del calculado";
            const deficitToReplace = deficitBases * correccionFactorValue;
            const volumenTotalNaHCO3 = deficitToReplace; 

            const warningText = "<span style='color: red; font-weight: bold;'>No copie este apartado, elija la manera de reponer dicho d√©ficit.</span><br>";
            let messageForCurrentResultDiv = "";
            let fullMessageForPauta = "";

            if (deficitToReplace > 0) {
                const optionsText = `Distribuir ${formatDecimal(volumenTotalNaHCO3)} ml de bicarbonato s√≥dico 1M durante las primeras 1-2 horas de infusi√≥n del suero pautado, o considerar la sueroterapia con bicarbonato 1/6M o Ringer lactato.`;
                messageForCurrentResultDiv = `${warningText}${optionsText}`;
                fullMessageForPauta = `${warningText}${optionsText}`;
            } else {
                messageForCurrentResultDiv = "No se requiere correcci√≥n de acidosis o el d√©ficit a reponer es cero.";
                fullMessageForPauta = "No se requiere correcci√≥n de acidosis o el d√©ficit a reponer es cero.";
            }

            resultadoDiv.innerHTML = `<strong>C√°lculo de Correcci√≥n de Acidosis:</strong><br>
                D√©ficit de bases calculado: ${formatDecimal(deficitBases)} mEq<br>
                D√©ficit a reponer (${fractionText}): ${formatDecimal(deficitToReplace)} mEq<br>
                ${messageForCurrentResultDiv}`;
            resultadoDiv.classList.add('show');

            pautaFinalData.acidosisVolumenNaHCO3 = formatDecimal(volumenTotalNaHCO3);
            pautaFinalData.acidosisCorreccionFactor = correccionAcidosis; 
            pautaFinalData.acidosisFractionText = fractionText; 
            pautaFinalData.acidosisDeficitBases = formatDecimal(deficitBases);
            pautaFinalData.acidosisDeficitToReplace = formatDecimal(deficitToReplace);
            pautaFinalData.acidosisDistribucionMsg = fullMessageForPauta;
            updatePautaFinal();
        }


        function updatePautaFinal() {
            try {
                const pautaFinalDiv = document.getElementById('pauta-final');
                const pautaFinalData = pautaFinalDiv.dataset;
                const copyContainer = document.getElementById('pauta-final-copy-container');

                let finalPautaHTML = '';
                const modalidad = document.getElementById('modalidad').value;
                const volumenBolsa = getSelectedVolumeBolsa();
                let modalityCalculated = false;

                if (modalidad === 'basales' && pautaFinalData.volumenBasal && pautaFinalData.ritmoBasal) {
                    const fraccionDesc = pautaFinalData.fraccionBasalDesc || "Necesidades basales completas";
                    finalPautaHTML += `<strong>Necesidades Basales (${fraccionDesc})</strong><br>
                                       Volumen total en 24h: ${pautaFinalData.volumenBasal} ml<br>
                                       Ritmo de infusi√≥n: ${pautaFinalData.ritmoBasal} ml/h<br><br>`;
                    modalityCalculated = true;
                } else if (modalidad === 'rapida' && pautaFinalData.volumenRapida && pautaFinalData.ritmoRapida) {
                    const tiempoDesc = pautaFinalData.tiempoRehidratacionRapidaDesc || "2 horas";
                    finalPautaHTML += `<strong>Rehidrataci√≥n R√°pida</strong><br>
                                       Ritmo de infusi√≥n: ${pautaFinalData.ritmoRapida} ml/h<br>
                                       Volumen total a infundir en ${tiempoDesc}: ${pautaFinalData.volumenRapida} ml<br><br>`;
                    modalityCalculated = true;
                } else if (modalidad === 'clasica' && pautaFinalData.volumenClasica && pautaFinalData.ritmoClasica) {
                    finalPautaHTML += `<strong>Rehidrataci√≥n Cl√°sica</strong><br>
                                       Volumen total a reponer en 24h: ${pautaFinalData.volumenClasica} ml<br>
                                       Ritmo de infusi√≥n en 24h: ${pautaFinalData.ritmoClasica} ml/h<br><br>`;
                    modalityCalculated = true;
                }

                if (pautaFinalData.glucosaAporte && pautaFinalData.glucosaUnidad) {
                    finalPautaHTML += `<strong>Glucosa:</strong><br>`;
                    if (pautaFinalData.glucosaGR50 && parseFloat(pautaFinalData.glucosaGR50) > 0) {
                        finalPautaHTML += `A√±adir ${pautaFinalData.glucosaGR50} ml de GR50 a cada ${formatDecimal(volumenBolsa, 0)} ml del suero pautado.<br>`;
                    } else if (pautaFinalData.glucosaMensajeAdicional && pautaFinalData.glucosaMensajeAdicional !== 'Calculando aportes con glucosa base al 5%.' && pautaFinalData.glucosaMensajeAdicional !== 'Calculando aportes con glucosa base al 5%. No se a√±ade GR50 adicional.') {
                         finalPautaHTML += `${pautaFinalData.glucosaMensajeAdicional}<br>`;
                    }
                    if (pautaFinalData.glucosaConcentracionDeseada) {
                         finalPautaHTML += `Concentraci√≥n de glucosa: ${pautaFinalData.glucosaConcentracionDeseada} %<br>`;
                    }
                     finalPautaHTML += `Aportes de Glucosa: ${pautaFinalData.glucosaAporte} ${pautaFinalData.glucosaUnidad}<br><br>`;
                } else if (pautaFinalData.glucosaMensajeAdicional) {
                     finalPautaHTML += `<strong>Glucosa:</strong><br>${pautaFinalData.glucosaMensajeAdicional}<br><br>`;
                }

                const potasioTab = document.getElementById('potasio-tab');
                if (!potasioTab.classList.contains('disabled') && pautaFinalData.potasioDecision) {
                    finalPautaHTML += `<strong>Potasio:</strong><br>`;
                    if (parseFloat(pautaFinalData.potasioVolumenToAdd) > 0) {
                        finalPautaHTML += `A√±adir ${pautaFinalData.potasioVolumenToAdd} ml de ${pautaFinalData.potasioForma} a cada ${formatDecimal(volumenBolsa, 0)} ml del suero pautado.<br>`;
                    } else if (pautaFinalData.potasioDecision === 'none' && (pautaFinalData.sueroBaseTienePotasio === 'false' || !pautaFinalData.sueroBaseTienePotasio)) {
                         finalPautaHTML += "Sin a√±adir potasio al suero.<br>";
                    } else if (pautaFinalData.potasioMensaje) { 
                        finalPautaHTML += `${pautaFinalData.potasioMensaje}<br>`;
                    } else if (pautaFinalData.potasioDecision !== 'none' && parseFloat(pautaFinalData.potasioVolumenToAdd) === 0) {
                         finalPautaHTML += `No se necesita a√±adir potasio adicional.<br>`;
                    }

                    if (pautaFinalData.potasioConcentracionDeseada) {
                        finalPautaHTML += `Concentraci√≥n de potasio: ${pautaFinalData.potasioConcentracionDeseada} mEq/L<br>`;
                    }
                    
                    if (pautaFinalData.potasioAporte_mEq_kg_h) {
                        finalPautaHTML += `Aporte de potasio: ${pautaFinalData.potasioAporte_mEq_kg_h} mEq/kg/h<br>`;
                    } 
                     finalPautaHTML += "<br>";
                }

                const sodioTab = document.getElementById('sodio-tab');
                if (!sodioTab.classList.contains('disabled')) {
                    if (pautaFinalData.sodioVolumenAdd !== undefined) {
                        finalPautaHTML += `<strong>Sodio:</strong><br>`; 

                        if (pautaFinalData.sodioNota && pautaFinalData.sodioNota !== '') {
                            finalPautaHTML += `${pautaFinalData.sodioNota}<br>`;
                        } else if (pautaFinalData.sodioVolumenAdd === 'Error') {
                             finalPautaHTML += `Error al calcular el sodio: Concentraci√≥n deseada inalcanzable.<br>`;
                        } else if (parseFloat(pautaFinalData.sodioVolumenAdd) > 0) {
                            finalPautaHTML += `A√±adir ${pautaFinalData.sodioVolumenAdd} ml de Suero Salino al 20% a cada ${formatDecimal(volumenBolsa, 0)} ml del suero base.<br>`;
                        } else {
                             finalPautaHTML += `Se utilizar√° el suero base sin a√±adir Suero Salino al 20%.<br>`;
                        }
                        if (pautaFinalData.sodioConcentracionDeseada) {
                             finalPautaHTML += `Concentraci√≥n de sodio: ${pautaFinalData.sodioConcentracionDeseada} mEq/L<br>`;
                        }
                        finalPautaHTML += "<br>";
                    }
                }

                if (pautaFinalData.acidosisVolumenNaHCO3 && pautaFinalData.acidosisDistribucionMsg) {
                     finalPautaHTML += `<div id="acidosis-pauta-final"><strong>Correcci√≥n de Acidosis:</strong><br>`;
                     if (pautaFinalData.acidosisDeficitToReplace && pautaFinalData.acidosisFractionText) {
                         finalPautaHTML += `D√©ficit a reponer (${pautaFinalData.acidosisFractionText}): ${pautaFinalData.acidosisDeficitToReplace} mEq.<br>`;
                     }
                     finalPautaHTML += `${pautaFinalData.acidosisDistribucionMsg}<br><br></div>`;
                }

                if (finalPautaHTML.trim() === '') {
                    pautaFinalDiv.classList.remove('show');
                    copyContainer.style.display = 'none';
                } else {
                    pautaFinalDiv.innerHTML = finalPautaHTML;
                    pautaFinalDiv.classList.add('show');
                    copyContainer.style.display = 'block';
                }
            } catch (error) {
                console.error("Error en updatePautaFinal:", error);
                const pautaFinalDiv = document.getElementById('pauta-final');
                pautaFinalDiv.innerHTML = `<strong style="color: red;">Error al generar la pauta final: ${error.message}. Consulte la consola.</strong>`;
                pautaFinalDiv.classList.add('show');
                 const copyContainer = document.getElementById('pauta-final-copy-container');
                 if(copyContainer) copyContainer.style.display = 'none';
            }
        }

        function copyPautaToClipboard() {
            const pautaFinalData = document.getElementById('pauta-final').dataset;
            const modalidad = document.getElementById('modalidad').value;
            const volumenBolsa = getSelectedVolumeBolsa();

            let textToCopy = "";
            let acidosisPresent = false;

            if (modalidad === 'basales' && pautaFinalData.ritmoBasal) {
                const fraccionDesc = pautaFinalData.fraccionBasalDesc || "Necesidades basales completas";
                textToCopy += `+Necesidades Basales (${fraccionDesc})\n`;
                textToCopy += `-Volumen total en 24h: ${pautaFinalData.volumenBasal} ml\n`;
                textToCopy += `-Ritmo de infusi√≥n: ${pautaFinalData.ritmoBasal} ml/h\n\n`;
            } else if (modalidad === 'rapida' && pautaFinalData.ritmoRapida) {
                const tiempoDesc = pautaFinalData.tiempoRehidratacionRapidaDesc || "2 horas";
                textToCopy += `+Rehidrataci√≥n R√°pida\n`;
                textToCopy += `-Volumen total a infundir en ${tiempoDesc}: ${pautaFinalData.volumenRapida} ml\n`;
                textToCopy += `-Ritmo de infusi√≥n: ${pautaFinalData.ritmoRapida} ml/h\n\n`;
            } else if (modalidad === 'clasica' && pautaFinalData.ritmoClasica) {
                textToCopy += `+Rehidrataci√≥n Cl√°sica\n`;
                textToCopy += `-Volumen total a reponer en 24h: ${pautaFinalData.volumenClasica} ml\n`;
                textToCopy += `-Ritmo de infusi√≥n en 24h: ${pautaFinalData.ritmoClasica} ml/h\n\n`;
            }

            if (pautaFinalData.glucosaAporte && pautaFinalData.glucosaUnidad) {
                textToCopy += `+Glucosa:\n`;
                 if (pautaFinalData.glucosaGR50 && parseFloat(pautaFinalData.glucosaGR50) > 0) {
                    textToCopy += `-A√±adir ${pautaFinalData.glucosaGR50} ml de GR50 a cada ${formatDecimal(volumenBolsa, 0)} ml del suero pautado.\n`;
                }
                if (pautaFinalData.glucosaConcentracionDeseada) {
                    textToCopy += `-Concentraci√≥n de glucosa: ${pautaFinalData.glucosaConcentracionDeseada} %\n`;
                }
                textToCopy += `-Aportes de Glucosa: ${pautaFinalData.glucosaAporte} ${pautaFinalData.glucosaUnidad}\n\n`;
            }

            const potasioTab = document.getElementById('potasio-tab');
            if (!potasioTab.classList.contains('disabled') && pautaFinalData.potasioDecision) {
                 textToCopy += `+Potasio:\n`;
                 if (parseFloat(pautaFinalData.potasioVolumenToAdd) > 0) {
                    textToCopy += `-A√±adir ${pautaFinalData.potasioVolumenToAdd} ml de ${pautaFinalData.potasioForma} a cada ${formatDecimal(volumenBolsa, 0)} ml del suero pautado.\n`;
                }
                 if (pautaFinalData.potasioConcentracionDeseada) {
                    textToCopy += `-Concentraci√≥n de potasio: ${pautaFinalData.potasioConcentracionDeseada} mEq/L\n`;
                }
                if (pautaFinalData.potasioAporte_mEq_kg_h) {
                    textToCopy += `-Aporte de potasio: ${pautaFinalData.potasioAporte_mEq_kg_h} mEq/kg/h\n`;
                }
                textToCopy += `\n`;
            }
            
            const sodioTab = document.getElementById('sodio-tab');
            if (!sodioTab.classList.contains('disabled') && pautaFinalData.sodioVolumenAdd !== undefined) {
                 textToCopy += `+Sodio:\n`;
                 if (parseFloat(pautaFinalData.sodioVolumenAdd) > 0) {
                     textToCopy += `-A√±adir ${pautaFinalData.sodioVolumenAdd} ml de Suero Salino al 20% a cada ${formatDecimal(volumenBolsa, 0)} ml del suero base.\n`;
                 }
                 if (pautaFinalData.sodioConcentracionDeseada) {
                    textToCopy += `-Concentraci√≥n de sodio: ${pautaFinalData.sodioConcentracionDeseada} mEq/L\n`;
                 }
                 textToCopy += `\n`;
            }

            if (pautaFinalData.acidosisDeficitToReplace && parseFloat(pautaFinalData.acidosisDeficitToReplace) > 0) {
                acidosisPresent = true;
            }

            const textArea = document.createElement("textarea");
            textArea.value = textToCopy.trim();
            textArea.style.position = 'fixed';
            textArea.style.top = '-9999px';
            textArea.style.left = '-9999px';
            document.body.appendChild(textArea);
            textArea.select();
            textArea.focus();
            try {
                document.execCommand('copy');
                const toast = document.getElementById('copy-toast');
                if (acidosisPresent) {
                    toast.textContent = "Pauta final copiada salvo el apartado acidosis, elija como reponer dicho d√©ficit.";
                } else {
                    toast.textContent = "Pauta copiada al portapapeles.";
                }
                toast.classList.add('show');
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            } catch (err) {
                console.error('Error al copiar la pauta: ', err);
            }
            document.body.removeChild(textArea);
        }

        function handleSueroBasePotasioChange() {
            const sueroBaseTienePotasio = document.querySelector('input[name="sueroBaseConPotasio"]:checked').value;
            const sinAnadirRadio = document.querySelector('input[name="concentracionPotasio"][value="none"]');
            const basalesRadio = document.querySelector('input[name="concentracionPotasio"][value="20"]'); 

            if (sueroBaseTienePotasio === 'true') { 
                sinAnadirRadio.disabled = true; 
                if (sinAnadirRadio.checked) { 
                    basalesRadio.checked = true;
                }
            } else { 
                sinAnadirRadio.disabled = false; 
            }
            updateLabelStyles('concentracionPotasio'); 
            updateLabelStyles('sueroBaseConPotasio');
        }

        function calcularGorelickRapida() {
            const items = document.querySelectorAll('#gorelick-items-container-rapida input[type="checkbox"]:checked');
            const score = items.length;
            const resultadoDiv = document.getElementById('resultado-gorelick-rapida');
            let resultadoTexto = `Puntuaci√≥n Gorelick: ${score}. `;

            if (score < 3) {
                resultadoTexto += "Deshidrataci√≥n leve (<5%)";
            } else if (score >= 3 && score <= 5) {
                resultadoTexto += "Deshidrataci√≥n moderada (5-9%)";
            } else { 
                resultadoTexto += "Deshidrataci√≥n grave (>9%)";
            }
            resultadoDiv.innerHTML = resultadoTexto;
            resultadoDiv.classList.add('show');
        }
        
        function calcularGorelickClasica() {
            const items = document.querySelectorAll('#gorelick-items-container-clasica input[type="checkbox"]:checked');
            const score = items.length;
            const resultadoDiv = document.getElementById('resultado-gorelick-clasica'); 
            let resultadoTexto = `Puntuaci√≥n Gorelick: ${score}. `;

            if (score < 3) {
                resultadoTexto += "Deshidrataci√≥n leve (<5%)";
            } else if (score >= 3 && score <= 5) {
                resultadoTexto += "Deshidrataci√≥n moderada (5-9%)";
            } else { 
                resultadoTexto += "Deshidrataci√≥n grave (>9%)";
            }
            resultadoDiv.innerHTML = resultadoTexto;
            resultadoDiv.classList.add('show');
        }

        function toggleDeficitCalculationMethod(modality) {
            if (modality === 'clasica') {
                const isPesoCuantificado = document.querySelector('input[name="pesoCuantificadoClasica"]:checked').value === 'si';
                const perdidaPesoSection = document.getElementById('perdida-peso-section-clasica');
                const valoracionClinicaSection = document.getElementById('valoracion-clinica-section-clasica');

                if (isPesoCuantificado) {
                    perdidaPesoSection.style.display = 'block';
                    valoracionClinicaSection.style.display = 'none';
                } else {
                    perdidaPesoSection.style.display = 'none';
                    valoracionClinicaSection.style.display = 'block';
                }
            } else if (modality === 'rapida') {
                const isPesoCuantificado = document.querySelector('input[name="pesoCuantificado"]:checked').value === 'si';
                const perdidaPesoSection = document.getElementById('perdida-peso-section');
                const valoracionClinicaSection = document.getElementById('valoracion-clinica-section');
                
                if (isPesoCuantificado) {
                    perdidaPesoSection.style.display = 'block';
                    valoracionClinicaSection.style.display = 'none';
                } else {
                    perdidaPesoSection.style.display = 'none';
                    valoracionClinicaSection.style.display = 'block';
                }
            }
        }
        
        function calcularDeficitPorPesoPerdido() {
            const pesoPerdido = parseFloat(document.getElementById('pesoPerdido').value);
            const resultadoDiv = document.getElementById('resultado-deficit-rapida');
             if (isNaN(pesoPerdido) || pesoPerdido <= 0) {
                 resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un peso perdido v√°lido.</strong>';
                resultadoDiv.classList.add('show');
                return;
             }
             const deficit = pesoPerdido * 1000;
             resultadoDiv.innerHTML = `D√©ficit de l√≠quidos calculado: ${formatDecimal(deficit, 0)} ml`;
             resultadoDiv.dataset.deficitCalculado = deficit;
             resultadoDiv.classList.add('show');
        }
        
        function calcularDeficitPorPorcentaje() {
            const peso = parseFloat(document.getElementById('peso').value);
            const porcentaje = parseFloat(document.getElementById('porcentajeDeshidratacionRapida').value);
             const resultadoDiv = document.getElementById('resultado-deficit-rapida');

            if (isNaN(peso) || peso <= 0) {
                resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese el peso del paciente.</strong>';
                resultadoDiv.classList.add('show');
                return;
            }
             if (isNaN(porcentaje) || porcentaje <= 0) {
                 resultadoDiv.innerHTML = '<strong style="color: red;">Por favor, ingrese un porcentaje de deshidrataci√≥n v√°lido.</strong>';
                resultadoDiv.classList.add('show');
                return;
             }

             const deficit = porcentaje * 10 * peso;
             resultadoDiv.innerHTML = `D√©ficit de l√≠quidos calculado: ${formatDecimal(deficit, 0)} ml`;
             resultadoDiv.dataset.deficitCalculado = deficit;
             resultadoDiv.classList.add('show');
        }

        document.addEventListener('DOMContentLoaded', function () {
            openTab(null, 'glucosa'); 
            updateVolumeButtonStyles(); 
            
            document.getElementById('peso').addEventListener('input', resetPautaFinal);
            document.querySelectorAll('input[name="volumenBolsa"]').forEach(radio => {
                radio.addEventListener('change', () => {
                    updateVolumeButtonStyles();
                    resetPautaFinal();
                });
            });
            document.getElementById('modalidad').addEventListener('change', showModalidadOptions); 

            const radioCheckboxGroupsForStyleUpdate = [
                'expansionVolumen', 'perdidasMantenidas', 'correccionDeficit', 
                'sueroBaseConGlucosa', 'unidadGlucosa', 'sueroBaseConPotasio', 
                'concentracionPotasio', 'correccionAcidosis', 'pesoCuantificado', 'pesoCuantificadoClasica'
            ];
            radioCheckboxGroupsForStyleUpdate.forEach(groupName => {
                document.getElementsByName(groupName).forEach(input => {
                    input.addEventListener('change', () => updateLabelStyles(groupName));
                });
                updateLabelStyles(groupName); 
            });
            
             document.querySelectorAll('input[name^="gorelick"]').forEach(checkbox => {
                checkbox.addEventListener('change', function() {
                    const label = this.closest('label');
                    if (label) {
                        if (this.checked) {
                            label.classList.add('selected-option-text');
                        } else {
                            label.classList.remove('selected-option-text');
                        }
                    }
                });
            });

            document.querySelectorAll('input[name="pesoCuantificado"]').forEach(radio => {
                 radio.addEventListener('change', () => toggleDeficitCalculationMethod('rapida'));
            });
             document.querySelectorAll('input[name="pesoCuantificadoClasica"]').forEach(radio => {
                 radio.addEventListener('change', () => toggleDeficitCalculationMethod('clasica'));
            });
            
            const perdidasRadios = document.querySelectorAll('input[name="perdidasMantenidas"]');
            const perdidasValorInput = document.getElementById('perdidasMantenidasValor');
            perdidasRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'quantified') {
                        perdidasValorInput.style.display = 'inline-block';
                    } else {
                        perdidasValorInput.style.display = 'none';
                        perdidasValorInput.value = '';
                    }
                });
            });
            document.querySelector('input[name="perdidasMantenidas"][value="0"]').dispatchEvent(new Event('change'));

            document.querySelectorAll('input[name="sueroBaseConPotasio"]').forEach(radio => {
                radio.addEventListener('change', handleSueroBasePotasioChange);
            });
            handleSueroBasePotasioChange(); 

            const expansionRadios = document.querySelectorAll('input[name="expansionVolumen"]');
            const volumenExpansionInput = document.getElementById('volumenExpansionMl');
            expansionRadios.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value === 'si') {
                        volumenExpansionInput.style.display = 'inline-block';
                    } else {
                        volumenExpansionInput.style.display = 'none';
                        volumenExpansionInput.value = '';
                    }
                });
            });
             document.querySelector('input[name="expansionVolumen"][value="no"]').dispatchEvent(new Event('change'));

            const toggleSuerosBtn = document.getElementById('toggleSuerosBtn');
            const tablaSuerosContainer = document.getElementById('tablaSuerosContainer'); 
            toggleSuerosBtn.addEventListener('click', function() {
                tablaSuerosContainer.classList.toggle('show');
                if (tablaSuerosContainer.classList.contains('show')) {
                    this.innerHTML = '<span class="emoji-icon">üëÅÔ∏è</span>Ocultar Composici√≥n de Sueros';
                } else {
                    this.innerHTML = '<span class="emoji-icon">üëÅÔ∏è</span>Mostrar Composici√≥n de Sueros';
                }
            });

            const copyBtn = document.getElementById('copyPautaBtn');
            if(copyBtn) {
                copyBtn.addEventListener('click', copyPautaToClipboard);
            }
            
            toggleDeficitCalculationMethod('rapida');
            toggleDeficitCalculationMethod('clasica');
        });
    </script>
</body>
</html>
